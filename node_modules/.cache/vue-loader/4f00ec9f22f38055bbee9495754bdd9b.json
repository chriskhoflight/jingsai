{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\sys\\menu-manage\\menuManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\sys\\menu-manage\\menuManage.vue","mtime":1564969187236},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  getAllPermissionList,\r\n  addPermission,\r\n  editPermission,\r\n  deletePermission,\r\n  searchPermission,\r\n  getDictDataByType\r\n} from \"@/api/index\";\r\nimport IconChoose from \"@/views/components/custom/icon-choose\";\r\nimport util from \"@/libs/util.js\";\r\nexport default {\r\n  name: \"menu-manage\",\r\n  components: {\r\n    IconChoose\r\n  },\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      strict: true,\r\n      maxHeight: \"500px\",\r\n      expandLevel: 1,\r\n      menuModalVisible: false,\r\n      iconModalVisible: false,\r\n      selectList: [],\r\n      selectCount: 0,\r\n      showParent: false,\r\n      searchKey: \"\",\r\n      parentTitle: \"\",\r\n      // isMenu: false,\r\n      // isButton: false,\r\n      editTitle: \"\",\r\n      modalTitle: \"\",\r\n      menuForm: {\r\n        id: \"\",\r\n        title: \"\",\r\n        name: \"\",\r\n        icon: \"\",\r\n        path: \"\",\r\n        component: \"\",\r\n        parentId: \"\",\r\n        buttonType: \"\",\r\n        type: 0,\r\n        sortOrder: 0,\r\n        level: null,\r\n        status: 0,\r\n        url: \"\"\r\n      },\r\n      menuFormAdd:{\r\n        buttonType: \"\"\r\n      },\r\n      menuFormValidate: {\r\n        title: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }],\r\n        name: [{ required: true, message: \"路由英文名不能为空\", trigger: \"blur\" }],\r\n        icon: [{ required: true, message: \"图标不能为空\", trigger: \"click\" }],\r\n        path: [{ required: true, message: \"路径不能为空\", trigger: \"blur\" }],\r\n        component: [\r\n          { required: true, message: \"前端组件不能为空\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      submitLoading: false,\r\n      data: [],\r\n      dictPermissions: [],\r\n      iconType: 0,\r\n      dictComponent: [],\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getAllList();\r\n      this.getDictPermissions();\r\n      this.getDictComponent();\r\n    },\r\n    getDictPermissions() {\r\n      getDictDataByType(\"permission_type\").then(res => {\r\n        if (res.success) {\r\n          this.dictPermissions = res.result;\r\n        }\r\n      });\r\n    },\r\n    //加载组件类型\r\n    getDictComponent() {\r\n      getDictDataByType(\"component\").then(res => {\r\n        if (res.success) {\r\n          this.dictComponent = res.result;\r\n        }\r\n      });\r\n    },\r\n    showEditIcon(v) {\r\n      this.iconType = v;\r\n      this.iconModalVisible = true;\r\n    },\r\n    handleSelectIcon(v) {\r\n      if (this.iconType == 0) {\r\n        this.menuForm.icon = v;\r\n      } else {\r\n        this.menuFormAdd.icon = v;\r\n      }\r\n      this.iconModalVisible = false;\r\n    },\r\n    handleDropdown(name) {\r\n      if (name === \"expandOne\") {\r\n        this.expandLevel = 1;\r\n        this.getAllList();\r\n      } else if (name === \"expandTwo\") {\r\n        this.expandLevel = 2;\r\n        this.getAllList();\r\n      } else if (name === \"expandAll\") {\r\n        this.expandLevel = 3;\r\n        this.getAllList();\r\n      } else if (name === \"refresh\") {\r\n        this.getAllList();\r\n      }\r\n    },\r\n    getAllList() {\r\n      this.loading = true;\r\n      this.getRequest(\"/permission/getAllList\").then(res => {\r\n        this.loading = false;\r\n        if (res.success === true) {\r\n          // 仅展开指定级数 默认一级\r\n          let expandLevel = this.expandLevel;\r\n          res.result.forEach(function(e) {\r\n            if (expandLevel === 1) {\r\n              if (e.level === 1) {\r\n                e.expand = false;\r\n              }\r\n              if (e.children && e.children.length > 0) {\r\n                e.children.forEach(function(c) {\r\n                  if (c.level === 2) {\r\n                    c.expand = false;\r\n                  }\r\n                });\r\n              }\r\n            } else {\r\n              if (e.children && e.children.length > 0) {\r\n                e.children.forEach(function(c) {\r\n                  if (expandLevel === 2) {\r\n                    if (c.level === 2) {\r\n                      c.expand = false;\r\n                    }\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          });\r\n          this.data = res.result;\r\n        }\r\n      });\r\n    },\r\n    search() {\r\n      if (this.searchKey) {\r\n        this.loading = true;\r\n        searchPermission({ title: this.searchKey }).then(res => {\r\n          this.loading = false;\r\n          if (res.success) {\r\n            this.data = res.result;\r\n          }\r\n        });\r\n      } else {\r\n        this.getAllList();\r\n      }\r\n    },\r\n    selectTree(v) {\r\n      if (v.length > 0) {\r\n        // if (Number(v[0].level) === 1 || Number(v[0].level) === 2) {\r\n        //   this.isButton = false;\r\n        //   this.isMenu = true;\r\n        // } else {\r\n        //   this.isButton = true;\r\n        //   this.isMenu = false;\r\n        // }\r\n        if (Number(v[0].status) === 0) {\r\n          this.editStatus = true;\r\n        } else {\r\n          this.editStatus = false;\r\n        }\r\n        // 转换null为\"\"\r\n        for (let attr in v[0]) {\r\n          if (v[0][attr] === null) {\r\n            v[0][attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v[0]);\r\n        let menu = JSON.parse(str);\r\n        this.menuForm = menu;\r\n        this.editTitle = menu.title;\r\n      } else {\r\n        this.cancelEdit();\r\n      }\r\n    },\r\n    cancelEdit() {\r\n      let data = this.$refs.tree.getSelectedNodes()[0];\r\n      if (data) {\r\n        data.selected = false;\r\n      }\r\n      // this.isMenu = false;\r\n      // this.isButton = false;\r\n      this.$refs.menuForm.resetFields();\r\n      delete this.menuForm.id;\r\n      this.editTitle = \"\";\r\n    },\r\n    cancelAdd() {\r\n      this.menuModalVisible = false;\r\n    },\r\n    handleReset() {\r\n      let type = this.menuForm.type;\r\n      this.$refs.menuForm.resetFields();\r\n      this.editStatus = true;\r\n      this.menuForm.type = type;\r\n    },\r\n    submitEdit() {\r\n      this.$refs.menuForm.validate(valid => {\r\n        if (valid) {\r\n          if (!this.menuForm.id) {\r\n            this.$Message.warning(\"请先点击选择要修改的菜单节点\");\r\n            return;\r\n          }\r\n          this.submitLoading = true;\r\n          if (this.menuForm.sortOrder === null) {\r\n            this.menuForm.sortOrder = \"\";\r\n          }\r\n          if (this.menuForm.buttonType === null) {\r\n            this.menuForm.buttonType = \"\";\r\n          }\r\n          if (this.menuForm.type == 2) {\r\n            this.menuForm.name = \"\";\r\n            this.menuForm.icon = \"\";\r\n            this.menuForm.component = \"\";\r\n          }\r\n          editPermission(this.menuForm).then(res => {\r\n            this.submitLoading = false;\r\n            if (res.success === true) {\r\n              this.$Message.success(\"编辑成功\");\r\n              util.initRouter(this);\r\n              this.init();\r\n              this.menuModalVisible = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    submitAdd() {\r\n      this.$refs.menuFormAdd.validate(valid => {\r\n        if (valid) {\r\n          this.submitLoading = true;\r\n          if (this.menuFormAdd.type == 2) {\r\n            this.menuFormAdd.name = \"\";\r\n            this.menuFormAdd.icon = \"\";\r\n            this.menuFormAdd.component = \"\";\r\n          }\r\n          addPermission(this.menuFormAdd).then(res => {\r\n            this.submitLoading = false;\r\n            if (res.success === true) {\r\n              this.$Message.success(\"添加成功\");\r\n              util.initRouter(this);\r\n              this.init();\r\n              this.menuModalVisible = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n\r\n    //添加菜单\r\n    addMenu() {\r\n      if (this.menuForm.id == \"\" || this.menuForm.id == null) {\r\n        this.$Message.warning(\"请先点击选择一个菜单权限节点\");\r\n        return;\r\n      }\r\n      if (!(this.menuForm.type === 0 || this.menuForm.component == 'ParentView')) {\r\n        this.$Message.warning(\"请选择导航节点或父菜单节点\");\r\n        return;\r\n      }\r\n\r\n      this.parentTitle = this.menuForm.title;\r\n      this.modalTitle = \"添加菜单权限(可拖动)\";\r\n      this.showParent = true;\r\n      let type = 1;\r\n      \r\n      this.menuFormAdd = {\r\n        icon: \"\",\r\n        type: type,\r\n        parentId: this.menuForm.id,\r\n        level: Number(this.menuForm.level) + 1,\r\n        sortOrder: 0,\r\n        buttonType: \"\",\r\n        status: 0\r\n      };\r\n      this.menuModalVisible = true;\r\n    },\r\n    addRootMenu() {\r\n      this.modalTitle = \"添加导航栏(可拖动)\";\r\n      this.showParent = false;\r\n      this.menuFormAdd = {\r\n        component: \"Main\",\r\n        type: 0,  //0-导航  1-菜单页面 2-按钮 \r\n        level: 1, //\r\n        sortOrder: 0,\r\n        status: 0\r\n      };\r\n      this.menuModalVisible = true;\r\n    },\r\n    addButton(){\r\n      if (this.menuForm.id == \"\" || this.menuForm.id == null || this.menuForm.type != 1 || this.menuForm.component === 'ParentView') {\r\n        this.$Message.warning(\"请先点击选择一个菜单页面节点\");\r\n        return;\r\n      }\r\n      this.parentTitle = this.menuForm.title;\r\n      this.modalTitle = \"添加按钮(可拖动)\";\r\n      this.showParent = true;\r\n      let type = 2;\r\n      this.menuFormAdd = {\r\n        icon: \"\",\r\n        type: type,\r\n        parentId: this.menuForm.id,\r\n        level: Number(this.menuForm.level) + 1,\r\n        sortOrder: 0,\r\n        buttonType: \"\",\r\n        status: 0\r\n      };\r\n      this.menuModalVisible = true;\r\n    },\r\n    changeSelect(v) {\r\n      this.selectCount = v.length;\r\n      this.selectList = v;\r\n    },\r\n    delAll() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未勾选要删除的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function(e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          deletePermission(ids).then(res => {\r\n            if (res.success === true) {\r\n              this.$Message.success(\"删除成功\");\r\n              util.initRouter(this);\r\n              this.selectList = [];\r\n              this.selectCount = 0;\r\n              this.cancelEdit();\r\n              this.init();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    let height = document.documentElement.clientHeight;\r\n    this.maxHeight = Number(height-287) + \"px\";\r\n    this.init();\r\n  }\r\n};\r\n",null]}