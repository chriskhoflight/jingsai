{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\orders-manage\\ordersManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\orders-manage\\ordersManage.vue","mtime":1566557265779},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\less-loader\\dist\\cjs.js","mtime":1564973047851},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\r\n@import \"./ordersManage.less\";\r\n",{"version":3,"sources":["ordersManage.vue"],"names":[],"mappings":";;AAEA","file":"ordersManage.vue","sourceRoot":"src/views/orders/orders-manage","sourcesContent":[" <script src=\"//unpkg.com/iview@1.0.1/dist/iview.min.js\"></script>\r\n<style lang=\"less\">\r\n@import \"./ordersManage.less\";\r\n</style>\r\n\r\n<template>\r\n  <div class=\"search\">\r\n    <Row>\r\n      <Col>\r\n        <Card>\r\n          <Row>\r\n            <Form ref=\"searchForm\" :model=\"searchForm\" inline :label-width=\"70\" class=\"search-form\">\r\n              <Form-item label=\"派单方式\" prop=\"isManual\">\r\n                <Select\r\n                  v-model=\"searchForm.isManual\"\r\n                  placeholder=\"请选择\"\r\n                  clearable\r\n                  style=\"width: 200px\"\r\n                >\r\n                  <Option value=\"-1\">全部</Option>\r\n                  <Option value=\"0\">自动派单</Option>\r\n                  <Option value=\"1\">人工派单</Option>\r\n                </Select>\r\n              </Form-item>\r\n                            <Form-item label=\"订单状态\" prop=\"status\">\r\n                <Select\r\n                  v-model=\"searchForm.status\"\r\n                  placeholder=\"请选择\"\r\n                  clearable\r\n                  style=\"width: 200px\"\r\n                >\r\n                  <Option value=\"-1\">全部</Option>\r\n                  <Option value=\"0\">待分配</Option>\r\n                  <Option value=\"1\">系统派单中</Option>\r\n                  <Option value=\"2\">已接单</Option>\r\n                  <Option value=\"3\">拒绝接单</Option>\r\n                  <Option value=\"4\">待支付</Option>\r\n                  <Option value=\"5\">已取消</Option>\r\n                  <Option value=\"6\">已完成</Option>\r\n                  <Option value=\"7\">已支付</Option>\r\n                </Select>\r\n              </Form-item>\r\n              <Form-item label=\"订单号：\" prop=\"orderId\">\r\n                <Input\r\n                  type=\"text\"\r\n                  v-model=\"searchForm.orderId\"\r\n                  clearable\r\n                  placeholder=\"请输入订单号\"\r\n                  style=\"width: 200px\"\r\n                />\r\n              </Form-item>\r\n              <Form-item label=\"联系人：\" prop=\"contactsPhone\">\r\n                <Input\r\n                  type=\"text\"\r\n                  v-model=\"searchForm.contactsPhone\"\r\n                  clearable\r\n                  placeholder=\"请输入联系人手机号\"\r\n                  style=\"width: 200px\"\r\n                />\r\n              </Form-item>\r\n              <Form-item label=\"回收人：\" prop=\"phone\">\r\n                <Input\r\n                  type=\"text\"\r\n                  v-model=\"searchForm.phone\"\r\n                  clearable\r\n                  placeholder=\"请输入回收人员手机号\"\r\n                  style=\"width: 200px\"\r\n                />\r\n              </Form-item>\r\n\r\n              <Form-item label=\"订单类型\" prop=\"type\">\r\n                <Select v-model=\"searchForm.type\" placeholder=\"请选择\" clearable style=\"width: 200px\">\r\n                  <Option value=\"-1\">全部</Option>\r\n                  <Option value=\"0\">可再生回收</Option>\r\n                  <Option value=\"1\">付费回收</Option>\r\n                  <Option value=\"2\">运输服务</Option>\r\n                </Select>\r\n              </Form-item>\r\n              <Form-item label=\"支付方式\" prop=\"payType\">\r\n                <Select\r\n                  v-model=\"searchForm.payType\"\r\n                  placeholder=\"请选择\"\r\n                  clearable\r\n                  style=\"width: 200px\"\r\n                >\r\n                  <Option value=\"-1\">全部</Option>\r\n                  <Option value=\"0\">积分支付</Option>\r\n                  <Option value=\"1\">现金支付</Option>\r\n                  <Option value=\"2\">微信支付</Option>\r\n                  <!-- <Option value=\"3\">支付宝</Option> -->\r\n                  <Option value=\"9\">其他方式</Option>\r\n                </Select>\r\n              </Form-item>\r\n\r\n              <Form-item label=\"预约时间\">\r\n                <DatePicker\r\n                  v-model=\"selectDate\"\r\n                  type=\"daterange\"\r\n                  format=\"yyyy-MM-dd\"\r\n                  clearable\r\n                  @on-change=\"selectDateRange\"\r\n                  placeholder=\"选择起始时间\"\r\n                  style=\"width: 200px\"\r\n                ></DatePicker>\r\n              </Form-item>\r\n              <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n                <Button @click=\"handleSearch\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n                <Button @click=\"handleReset\">重置</Button>&nbsp;&nbsp;&nbsp;\r\n                <Badge dot :count=\"this.count\">\r\n                  <Button @click=\"getAlarmMethod\" type=\"primary\" icon=\"ios-alarm\">待办事项</Button>\r\n                </Badge>\r\n\r\n                <!-- <a class=\"drop-down\" @click=\"dropDown\">\r\n                  {{dropDownContent}}\r\n                  <Icon :type=\"dropDownIcon\"></Icon>\r\n                </a>-->\r\n              </Form-item>\r\n            </Form>\r\n          </Row>\r\n          <!-- <Row class=\"operation\"> -->\r\n          <!-- <Button @click=\"add\" type=\"primary\" icon=\"md-add\">添加订单</Button> -->\r\n          <!-- <Button @click=\"delAll\" icon=\"md-trash\">批量删除</Button> -->\r\n          <!-- <Dropdown @on-click=\"handleDropdown\">\r\n              <Button>\r\n                更多操作\r\n                <Icon type=\"md-arrow-dropdown\" />\r\n              </Button>\r\n\r\n              <DropdownMenu slot=\"list\">\r\n                <DropdownItem name=\"refresh\">刷新</DropdownItem>\r\n                <DropdownItem name=\"exportData\">导出所选数据</DropdownItem>\r\n                <DropdownItem name=\"exportAll\">导出全部数据</DropdownItem>\r\n                <DropdownItem name=\"importData\">导入数据</DropdownItem>\r\n              </DropdownMenu>\r\n            </Dropdown>\r\n            <circleLoading v-if=\"operationLoading\" />\r\n          </Row>\r\n          <Row>\r\n            <Alert show-icon>\r\n              已选择\r\n              <span class=\"select-count\">{{selectCount}}</span> 项\r\n              <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n          </Alert>-->\r\n          <!-- </Row> -->\r\n          <Row>\r\n            <Table\r\n              :loading=\"loading\"\r\n              border\r\n              :columns=\"columns\"\r\n              :data=\"data\"\r\n              sortable=\"custom\"\r\n              @on-sort-change=\"changeSort\"\r\n              @on-selection-change=\"showSelect\"\r\n              ref=\"table\"\r\n            ></Table>\r\n            <Table\r\n              :columns=\"exportColumns\"\r\n              :data=\"exportData\"\r\n              ref=\"exportTable\"\r\n              style=\"display:none\"\r\n            ></Table>\r\n          </Row>\r\n          <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n            <Page\r\n              :current=\"searchForm.pageNumber\"\r\n              :total=\"total\"\r\n              :page-size=\"searchForm.pageSize\"\r\n              @on-change=\"changePage\"\r\n              @on-page-size-change=\"changePageSize\"\r\n              :page-size-opts=\"[10,20,50]\"\r\n              size=\"small\"\r\n              show-total\r\n              show-elevator\r\n              show-sizer\r\n            ></Page>\r\n          </Row>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Modal\r\n      :title=\"modalTitle\"\r\n      v-model=\"userModalVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"500\"\r\n      :styles=\"{top: '30px'}\"\r\n    >\r\n      <Form ref=\"userForm\" :model=\"userForm\" :label-width=\"70\" :rules=\"userFormValidate\">\r\n        <FormItem label=\"userId\" prop=\"userId\">\r\n          <Input v-model=\"userForm.userId\" autocomplete=\"off\" />\r\n        </FormItem>\r\n        <FormItem label=\"type\" prop=\"type\">\r\n          <Input v-model=\"userForm.type\" autocomplete=\"off\" />\r\n        </FormItem>\r\n        <FormItem\r\n          label=\"recyclingPersonId\"\r\n          prop=\"recyclingPersonId\"\r\n          v-if=\"modalType===0\"\r\n          :error=\"errorPass\"\r\n        >\r\n          <Input v-model=\"userForm.recyclingPersonId\" autocomplete=\"off\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系名字\" prop=\"contactsName\">\r\n          <Input v-model=\"userForm.contactsName\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系手机\" prop=\"contactsPhone\">\r\n          <Input v-model=\"userForm.contactsPhone\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系地址\" prop=\"contactsAdderss\">\r\n          <Input v-model=\"userForm.contactsAdderss\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系楼层\" prop=\"contactsFloor\">\r\n          <Input v-model=\"userForm.contactsFloor\" />\r\n        </FormItem>\r\n        <FormItem label=\"是否电梯\" prop=\"isElevatorRoom\">\r\n          <Input v-model=\"userForm.isElevatorRoom\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系经度\" prop=\"longitude\">\r\n          <Input v-model=\"userForm.longitude\" />\r\n        </FormItem>\r\n        <FormItem label=\"联系维度\" prop=\"latitude\">\r\n          <Input v-model=\"userForm.latitude\" />\r\n        </FormItem>\r\n        <FormItem label=\"里程\" prop=\"mileage\">\r\n          <Input v-model=\"userForm.mileage\" />\r\n        </FormItem>\r\n        <FormItem label=\"预约时间\" prop=\"appointmentTime\">\r\n          <Input v-model=\"userForm.appointmentTime\" />\r\n        </FormItem>\r\n        <FormItem label=\"订单号\" prop=\"orderId\">\r\n          <Input v-model=\"userForm.orderId\" />\r\n        </FormItem>\r\n        <FormItem label=\"预估价格\" prop=\"estimatedPrice\">\r\n          <Input v-model=\"userForm.estimatedPrice\" />\r\n        </FormItem>\r\n        <FormItem label=\"实收价格\" prop=\"paidPrice\">\r\n          <Input v-model=\"userForm.paidPrice\" />\r\n        </FormItem>\r\n        <FormItem label=\"订单状态\" prop=\"status\">\r\n          <Input v-model=\"userForm.status\" />\r\n        </FormItem>\r\n\r\n        <FormItem label=\"人工派单\" prop=\"isManual\">\r\n          <Input v-model=\"userForm.isManual\" />\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelUser\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitUser\">提交</Button>\r\n      </div>\r\n    </Modal>\r\n    <!-- 待办事项 -->\r\n    <Modal v-model=\"alarmModalVisible\" title=\"待办事项\" :width=\"500\" class=\"modalClass\">\r\n      <i-circle\r\n        :size=\"300\"\r\n        :trail-width=\"5\"\r\n        :stroke-width=\"5\"\r\n        :percent=\"(this.allCount/this.orderCount)*100\"\r\n        stroke-linecap=\"square\"\r\n        stroke-color=\"#43a3fb\"\r\n        trail-color=\"#E52912\"\r\n      >\r\n        <div class=\"alarm\">\r\n          <h1>{{this.manualCount}}</h1>\r\n          <p>个订单需要人工派单</p>\r\n          <span>\r\n            <b>{{this.allCount}}</b>个订单尚未接单\r\n          </span>\r\n          <span>\r\n            总订单数:\r\n            <b>{{this.orderCount}}</b>\r\n          </span>\r\n        </div>\r\n      </i-circle>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  addOneOrder,\r\n  getAllOrders,\r\n  delOneOrder,\r\n  cancelOneOrder,\r\n  getAlarm\r\n} from \"@/api/orders\";\r\nimport {\r\n  getUserListData,\r\n  getAllRoleList,\r\n  getAllUserData,\r\n  getDictDataByType\r\n} from \"@/api/index\";\r\nimport expandRow from \"./expand.vue\";\r\nimport departmentChoose from \"@/views/components/custom/department-choose\";\r\nimport departmentTreeChoose from \"@/views/components/custom/department-tree-choose\";\r\nimport uploadPicInput from \"@/views/components/custom/upload-pic-input\";\r\nimport circleLoading from \"@/views/components/custom/circle-loading.vue\";\r\nexport default {\r\n  name: \"user-manage\",\r\n  components: {\r\n    circleLoading,\r\n    expandRow,\r\n    departmentChoose,\r\n    departmentTreeChoose,\r\n    uploadPicInput\r\n  },\r\n  data() {\r\n    const validatePassword = (rule, value, callback) => {\r\n      if (value.length < 6) {\r\n        callback(new Error(\"密码长度不得小于6位\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    const validateMobile = (rule, value, callback) => {\r\n      var reg = /^[1][3,4,5,7,8][0-9]{9}$/;\r\n      if (!reg.test(value)) {\r\n        callback(new Error(\"手机号格式错误\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      orderCount: 0, //总订单数\r\n      count: 0, //决定是否显示代办事项的红点\r\n      manualCount: 0,\r\n      allCount: 0,\r\n      alarmModalVisible: false, //待办事项的显示\r\n\r\n      //待办事项\r\n      pStyle: {\r\n        fontSize: \"16px\",\r\n        color: \"rgba(0,0,0,0.85)\",\r\n        lineHeight: \"24px\",\r\n        display: \"block\",\r\n        marginBottom: \"16px\"\r\n      },\r\n      loading: true,\r\n      operationLoading: false,\r\n      loadingExport: true,\r\n      modalExportAll: false,\r\n      drop: false,\r\n      // dropDownContent: \"展开\",\r\n      // dropDownIcon: \"ios-arrow-down\",\r\n      selectCount: 0,\r\n      selectList: [],\r\n      dataDep: [],\r\n      searchKey: \"\",\r\n      searchForm: {\r\n        isManual: -1, //派单方式  0 为自动派单  1为人工派单\r\n        payType: -1,\r\n        phone: \"\", //回收人员手机号码\r\n        orderId: \"\",\r\n        type: -1, //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n        contactsPhone: \"\",\r\n        status: -1, //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        sort: \"createTime\",\r\n        order: \"desc\",\r\n        startDate: \"\",\r\n        endDate: \"\"\r\n      },\r\n      selectDate: null,\r\n      modalType: 0,\r\n      userModalVisible: false,\r\n      modalTitle: \"\",\r\n      userForm: {\r\n        appointmentDay: \"\",\r\n        appointmentStartTime: \"\",\r\n        appointmentEndTime: \"\",\r\n        userId: \"\",\r\n        type: -1,\r\n        recyclingPersonId: \"\",\r\n        contactsName: \"\",\r\n        contactsPhone: \"\",\r\n        contactsAdderss: \"\",\r\n        contactsFloor: 0,\r\n        isElevatorRoom: -1,\r\n        longitude: 0,\r\n        latitude: 0,\r\n        mileage: 0,\r\n        orderId: \"\",\r\n        estimatedPrice: 0,\r\n        paidPrice: 0,\r\n        status: -1,\r\n        payType: -1,\r\n        isManual: -1\r\n      },\r\n      userRoles: [],\r\n      roleList: [],\r\n      errorPass: \"\",\r\n      userFormValidate: {\r\n        username: [\r\n          { required: true, message: \"账号不能为空\", trigger: \"blur\" }\r\n        ],\r\n        mobile: [\r\n          { required: true, message: \"手机号不能为空\", trigger: \"blur\" },\r\n          { validator: validateMobile, trigger: \"blur\" }\r\n        ],\r\n        email: [\r\n          { required: true, message: \"请输入邮箱地址\" },\r\n          { type: \"email\", message: \"邮箱格式不正确\" }\r\n        ]\r\n      },\r\n      submitLoading: false,\r\n      columns: [\r\n        // {\r\n        //   type: \"selection\",\r\n        //   width: 60,\r\n        //   align: \"center\",\r\n        //   fixed: \"left\"\r\n        // },\r\n        {\r\n          type: \"expand\",\r\n          width: 50,\r\n          fixed: \"left\",\r\n          render: (h, params) => {\r\n            return h(expandRow, {\r\n              props: {\r\n                row: params.row\r\n              }\r\n            });\r\n          }\r\n        },\r\n        {\r\n          type: \"index\",\r\n          width: 80,\r\n          align: \"center\",\r\n          fixed: \"left\",\r\n          title: \"序号\"\r\n        },\r\n        {\r\n          title: \"订单号\",\r\n          align: \"center\",\r\n          key: \"orderId\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\"\r\n        },\r\n        {\r\n          title: \"下单时间\",\r\n          align: \"center\",\r\n          key: \"createTime\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\"\r\n        },\r\n\r\n        {\r\n          title: \"订单类型\",\r\n          key: \"type\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          align: \"center\",\r\n          fixed: \"left\",\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            if (params.row.type === 0) {\r\n              re = \"可再生回收\";\r\n            } else if (params.row.type === 1) {\r\n              re = \"付费回收\";\r\n            } else if (params.row.type === 2) {\r\n              re = \"运输服务\";\r\n            }\r\n            return h(\"div\", re);\r\n          }\r\n        },\r\n\r\n        {\r\n          title: \"人工派单\",\r\n          key: \"isManual\",\r\n          align: \"center\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\",\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            if (params.row.isManual === 0) {\r\n              re = \"否\";\r\n            } else if (params.row.isManual === 1) {\r\n              re = \"是\";\r\n            }\r\n            return h(\"div\", re);\r\n          }\r\n        },\r\n        {\r\n          title: \"预约时间\",\r\n          key: \"appointmentTimeStr\",\r\n          align: \"center\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\"\r\n        },\r\n        {\r\n          title: \"支付方式\",\r\n          key: \"payType\",\r\n          align: \"center\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\",\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            if (params.row.payType === 0) {\r\n              re = \"积分支付\";\r\n            } else if (params.row.payType === 1) {\r\n              re = \"现金支付\";\r\n            } else if (params.row.payType === 2) {\r\n              re = \"微信支付\";\r\n            }\r\n            // else if (params.row.payType === 3) {\r\n            //   re = \"支付宝\";\r\n            // }\r\n            else if (params.row.payType === 9) {\r\n              re = \"其他\";\r\n            } else if (params.row.payType == null) {\r\n              re = \"暂无\";\r\n            }\r\n            return h(\"div\", re);\r\n          }\r\n        },\r\n        {\r\n          title: \"订单状态\",\r\n          align: \"center\",\r\n          key: \"status\",\r\n          minWidth: 145,\r\n          sortable: true,\r\n          fixed: \"left\",\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            var color = \"\";\r\n            if (params.row.status === 0) {\r\n              re = \"待分配\";\r\n              color = \"#2575EC\";\r\n            } else if (params.row.status === 1) {\r\n              re = \"系统派单中\";\r\n              color = \"\t#DAA520\";\r\n            } else if (params.row.status === 2) {\r\n              re = \"已接单\";\r\n              color = \"#DAA520\";\r\n            } else if (params.row.status === 3) {\r\n              re = \"拒绝接单\";\r\n              color = \"#E52812\";\r\n            } else if (params.row.status === 4) {\r\n              re = \"待支付\";\r\n              color = \"#3CB371\";\r\n            } else if (params.row.status === 5) {\r\n              re = \"已取消\";\r\n              color = \"#D3D3D3\";\r\n            } else if (params.row.status === 6) {\r\n              re = \"已完成\";\r\n              color = \"#77C955\";\r\n            } else if (params.row.status === 7) {\r\n              re = \"已支付\";\r\n              color = \"#556B2F\";\r\n            }\r\n            return h(\r\n              \"div\",\r\n              {\r\n                style: {\r\n                  color: color\r\n                }\r\n              },\r\n              re\r\n            );\r\n          }\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          width: 200,\r\n          align: \"center\",\r\n          fixed: \"right\",\r\n          render: (h, params) => {\r\n            let enableOrDisable = \"\";\r\n            // if (params.row.status == 0) {\r\n            //   enableOrDisable = h(\r\n            //     \"Button\",\r\n            //     {\r\n            //       props: {\r\n            //         size: \"small\"\r\n            //       },\r\n            //       style: {\r\n            //         marginRight: \"5px\"\r\n            //       },\r\n            //       on: {\r\n            //         click: () => {\r\n            //           this.disable(params.row);\r\n            //         }\r\n            //       }\r\n            //     },\r\n            //     \"禁用\"\r\n            //   );\r\n            // } else {\r\n            // enableOrDisable = h(\r\n            //   \"Button\",\r\n            //   {\r\n            //     props: {\r\n            //       type: \"success\",\r\n            //       size: \"small\"\r\n            //     },\r\n            //     style: {\r\n            //       marginRight: \"5px\"\r\n            //     },\r\n            //     on: {\r\n            //       click: () => {\r\n            //         this.enable(params.row);\r\n            //       }\r\n            //     }\r\n            //   },\r\n            //   \"启用\"\r\n            // );\r\n            // }\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"primary\",\r\n                    size: \"small\"\r\n                  },\r\n                  style: {\r\n                    marginRight: \"5px\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.orderDetail(params.row);\r\n                    }\r\n                  }\r\n                },\r\n                \"订单详情\"\r\n              ),\r\n              enableOrDisable,\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"error\",\r\n                    size: \"small\"\r\n                  },\r\n\r\n                  on: {\r\n                    click: () => {\r\n                      if (params.row.status != 5 && params.row.status != 6) {\r\n                        this.cancelOrder(params.row); //改成了取消订单的逻辑\r\n                      } else if (params.row.status === 5) {\r\n                        this.$Message.error(\"操作无效,该订单已经被取消!\");\r\n                      } else {\r\n                        this.$Message.error(\"操作无效,该订单已经完成!\");\r\n                      }\r\n                    }\r\n                  }\r\n                },\r\n                \"取消订单\"\r\n              )\r\n            ]);\r\n          }\r\n        }\r\n      ],\r\n      exportColumns: [\r\n        {\r\n          title: \"用户名\",\r\n          key: \"username\"\r\n        },\r\n        {\r\n          title: \"头像\",\r\n          key: \"avatar\"\r\n        },\r\n        {\r\n          title: \"所属部门ID\",\r\n          key: \"departmentId\"\r\n        },\r\n        {\r\n          title: \"所属部门\",\r\n          key: \"departmentTitle\"\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\"\r\n        },\r\n        {\r\n          title: \"邮箱\",\r\n          key: \"email\"\r\n        },\r\n        {\r\n          title: \"性别\",\r\n          key: \"sex\"\r\n        },\r\n        {\r\n          title: \"用户类型\",\r\n          key: \"type\"\r\n        },\r\n        {\r\n          title: \"状态\",\r\n          key: \"status\"\r\n        },\r\n        {\r\n          title: \"删除标志\",\r\n          key: \"delFlag\"\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\"\r\n        },\r\n        {\r\n          title: \"更新时间\",\r\n          key: \"updateTime\"\r\n        }\r\n      ],\r\n      data: [],\r\n      exportData: [],\r\n      total: 0,\r\n      dictSex: []\r\n    };\r\n  },\r\n  methods: {\r\n    isAlarm(data) {\r\n      for (var i = 0; i < data.length; i++) {\r\n        if (\r\n          data[i].isManual == 1 &&\r\n          (data[i].status == 0 || data[i].status == 0)\r\n        ) {\r\n          this.count = 1;\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    //获取待办事项\r\n    getAlarmMethod() {\r\n      this.alarmModalVisible = true;\r\n      getAlarm().then(res => {\r\n        if (res.success === true) {\r\n          this.orderCount = res.result.orderCount;\r\n          this.allCount = res.result.allCount;\r\n          this.manualCount = res.result.manualCount;\r\n        }\r\n      });\r\n    },\r\n    init() {\r\n      this.getUserList();\r\n      this.getDictSexData();\r\n    },\r\n    getDictSexData() {\r\n      // 获取性别字典数据\r\n      getDictDataByType(\"sex\").then(res => {\r\n        if (res.success) {\r\n          this.dictSex = res.result;\r\n        }\r\n      });\r\n    },\r\n    handleSelectDepTree(v) {\r\n      this.userForm.departmentId = v[0];\r\n    },\r\n    handleSelectDep(v) {\r\n      this.searchForm.departmentId = v;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getUserList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getUserList();\r\n    },\r\n    selectDateRange(v) {\r\n      if (v) {\r\n        this.searchForm.startDate = v[0];\r\n        this.searchForm.endDate = v[1];\r\n      }\r\n    },\r\n    getUserList() {\r\n      // 多条件搜索用户列表\r\n      this.loading = true;\r\n      // 避免后台默认值\r\n      if (!this.searchForm.type) {\r\n        this.searchForm.type = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n      }\r\n      if (!this.searchForm.status) {\r\n        this.searchForm.status = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n      }\r\n      if (!this.searchForm.payType) {\r\n        this.searchForm.payType = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n      }\r\n      getAllOrders(this.searchForm).then(res => {\r\n        this.loading = false;\r\n        if (res.success === true) {\r\n          this.data = res.result.records;\r\n          this.isAlarm(res.result.records);\r\n          this.total = res.result.total;\r\n        }\r\n      });\r\n    },\r\n    handleSearch() {\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getUserList();\r\n    },\r\n    handleReset() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.selectDate = null;\r\n      this.searchForm.startDate = \"\";\r\n      this.searchForm.endDate = \"\";\r\n      this.selectDep = [];\r\n      this.searchForm.departmentId = \"\";\r\n      // 重新加载数据\r\n      this.getUserList();\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order === \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getUserList();\r\n    },\r\n    getRoleList() {\r\n      getAllRoleList().then(res => {\r\n        if (res.success === true) {\r\n          this.roleList = res.result;\r\n        }\r\n      });\r\n    },\r\n    handleDropdown(name) {\r\n      if (name === \"refresh\") {\r\n        this.getUserList();\r\n      } else if (name === \"exportData\") {\r\n        if (this.selectCount <= 0) {\r\n          this.$Message.warning(\"您还未选择要导出的数据\");\r\n          return;\r\n        }\r\n        this.$Modal.confirm({\r\n          title: \"确认导出\",\r\n          content: \"您确认要导出所选 \" + this.selectCount + \" 条数据?\",\r\n          onOk: () => {\r\n            this.$refs.exportTable.exportCsv({\r\n              filename: \"用户数据\"\r\n            });\r\n          }\r\n        });\r\n      } else if (name === \"exportAll\") {\r\n        this.modalExportAll = true;\r\n      } else if (name === \"importData\") {\r\n        this.$Modal.info({\r\n          title: \"暂未开发\",\r\n          content: \"请期待\"\r\n        });\r\n      }\r\n    },\r\n    exportAll() {\r\n      getAllOrders.then(res => {\r\n        this.modalExportAll = false;\r\n        if (res.success) {\r\n          this.exportData = res.result;\r\n          setTimeout(() => {\r\n            this.$refs.exportTable.exportCsv({\r\n              filename: \"用户全部数据\"\r\n            });\r\n          }, 1000);\r\n        }\r\n      });\r\n    },\r\n    cancelUser() {\r\n      this.userModalVisible = false;\r\n    },\r\n    submitUser() {\r\n      this.$refs.userForm.validate(valid => {\r\n        if (valid) {\r\n          if (this.modalType === 0) {\r\n            // 添加用户 避免编辑后传入id\r\n            delete this.userForm.id;\r\n            delete this.userForm.status;\r\n            this.submitLoading = true;\r\n            addOneOrder(this.userForm).then(res => {\r\n              this.submitLoading = false;\r\n              if (res.success === true) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getUserList();\r\n                this.userModalVisible = false;\r\n              }\r\n            });\r\n          } else {\r\n            // 编辑\r\n            this.submitLoading = true;\r\n            editUser(this.userForm).then(res => {\r\n              this.submitLoading = false;\r\n              if (res.success === true) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getUserList();\r\n                this.userModalVisible = false;\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    handleUpload(v) {\r\n      this.userForm.avatar = v;\r\n    },\r\n    // add() {\r\n    //   this.modalType = 0;\r\n    //   this.modalTitle = \"添加订单\";\r\n    //   this.$refs.userForm.resetFields();\r\n    //   this.userModalVisible = true;\r\n    // },\r\n\r\n    //打开新的页面显示订单详情并可以人工派单\r\n    orderDetail(v) {\r\n      // this.modalTitle = \"订单详情\";    别注释\r\n      // this.$router.push({path:'/order-detail',query:{orderData:v}});\r\n      this.$router.push({\r\n        name: \"order-detail-manage\",\r\n        query: { orderData: v }\r\n      });\r\n    },\r\n\r\n    cancelOrder(v) {\r\n      this.$Modal.confirm({\r\n        title: \"确认取消\",\r\n        content: \"您确认要取消订单 \" + v.orderId + \" ?\",\r\n        onOk: () => {\r\n          cancelOneOrder(v).then(res => {\r\n            this.operationLoading = true;\r\n            if (res.success === true) {\r\n              this.operationLoading = false;\r\n              this.$Message.success(res.message);\r\n              this.getUserList();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    showSelect(e) {\r\n      this.exportData = e;\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    delAll() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要删除的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function(e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          this.operationLoading = true;\r\n          delOneOrder(ids).then(res => {\r\n            this.operationLoading = false;\r\n            if (res.success === true) {\r\n              this.$Message.success(\"删除成功\");\r\n              this.clearSelectAll();\r\n              this.getUserList();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    this.init();\r\n    this.getRoleList();\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.alarm {\r\n  & h1 {\r\n    color: #e52912;\r\n    font-size: 28px;\r\n    font-weight: normal;\r\n  }\r\n  & p {\r\n    color: #657180;\r\n    font-size: 14px;\r\n    margin: 10px 0 15px;\r\n  }\r\n  & span {\r\n    display: block;\r\n    padding-top: 15px;\r\n    color: #657180;\r\n    font-size: 14px;\r\n    &:before {\r\n      content: \"\";\r\n      display: block;\r\n      width: 50px;\r\n      height: 1px;\r\n      margin: 0 auto;\r\n      background: #e0e3e6;\r\n      position: relative;\r\n      top: -15px;\r\n    }\r\n  }\r\n  & span i {\r\n    font-style: normal;\r\n    color: #3f414d;\r\n  }\r\n  text-align: center;\r\n}\r\n.modalClass {\r\n  text-align: center;\r\n}\r\n.demo-drawer-profile {\r\n  font-size: 14px;\r\n}\r\n.demo-drawer-profile .ivu-col {\r\n  margin-bottom: 12px;\r\n}\r\n</style>"]}]}