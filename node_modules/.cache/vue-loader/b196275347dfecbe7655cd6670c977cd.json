{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\order-detail-manage\\orderDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\order-detail-manage\\orderDetail.vue","mtime":1568024242635},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  getOrderDetail,\r\n  getOnlineRp,\r\n  dispatchOrder,\r\n  manualFinishOrder\r\n} from \"@/api/orders\";\r\nimport { truncate } from \"fs\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      //图片url list\r\n      // urlsList: [],\r\n      imgModal: false, //查看大图\r\n      bigImgUrl: null, //大图链接\r\n\r\n      isBigImg: false,\r\n      isRefuse: null,\r\n      isCancel: null,\r\n      isFinish: null,\r\n      isPay: null,\r\n      isPayed: null,\r\n      //在线回收人员\r\n      RecyclingPersonnel: [],\r\n      color: \"color\",\r\n      dispatchForm: {\r\n        RecyclingPersonnelId: \"\",\r\n        orderId: \"\",\r\n        RecyclingPersonnelName: \"\"\r\n      },\r\n      // confirmDialog: false, //人工派单确定对话框\r\n\r\n      dispatchModalVisible: false, //人工派单对话框是否显示\r\n\r\n      orderDetailForm: {\r\n        id: \"\", //主键\r\n        orderId: \"\" //订单号-\r\n      },\r\n      //前一个页面传来的数据\r\n      orderDetail: {\r\n        userRemark:\"\",\r\n        recyclinRemark: \"\",\r\n        score: null,   //用户评分\r\n        recScore: null,  //回收人员评分\r\n        comment: \"\" , //用户评价\r\n        recComment: \"\",  //回收人员评分\r\n        estimatedPrice:0.00,\r\n        paidPrice:0.00,\r\n        additionalCosts:0.00,\r\n        destContactsAdderss:\"\",\r\n        destContactsName:\"\",\r\n        destContactsPhone:\"\",\r\n        additionalCosts:0,\r\n        id: \"\", //主键\r\n        imgUrls: \"\",\r\n        appointmentDay: \"\",\r\n        appointmentStartTime: \"\",\r\n        appointmentEndTime: \"\",\r\n        phone: \"\", //回收人员手机号码-\r\n        orderId: \"\", //订单号-\r\n        type: -1, //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type-\r\n        contactsPhone: \"\", //联系人手机号-\r\n        contactsName: \"\", //联系人名字 -\r\n        isElevatorRoom: -1, //是否电梯房-\r\n        contactsFloor: -1, //联系人楼层 -\r\n        contactsAdderss: \"\", //联系人地址-\r\n        name: \"\", //回收人员姓名-\r\n        status: -1 //-后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\r\n      },\r\n\r\n      //商品的表格\r\n      columns: [\r\n        {\r\n          title: \"商品名称\",\r\n          key: \"name\"\r\n        },\r\n        {\r\n          title: \"商品数量\",\r\n          key: \"goodsNum\"\r\n        },\r\n        {\r\n          title: \"预估最小价格(单价)\",\r\n          key: \"minPrice\"\r\n        },\r\n        {\r\n          title: \"预估最大价格(单价)\",\r\n          key: \"maxPrice\"\r\n        },\r\n        {\r\n          title: \"该类商品预估最小价格\",\r\n          key: \"goodMinTotalPrice\"\r\n        },\r\n        {\r\n          title: \"该类商品预估最大价格\",\r\n          key: \"goodMaxTotalPrice\"\r\n        }\r\n      ],\r\n\r\n      //在线回收人员的表格\r\n      RecyclingPersonnelColumns: [\r\n        {\r\n          title: \"姓名\",\r\n          key: \"name\"\r\n        },\r\n        {\r\n          title: \"手机号码\",\r\n          key: \"phone\"\r\n        },\r\n        {\r\n          title: \"地址\",\r\n          key: \"address\"\r\n        }\r\n      ],\r\n      //订单商品的明细\r\n      OrderGoodsList: []\r\n    };\r\n  },\r\n  computed: {\r\n    //展示评价\r\n    isRemark: function(){\r\n      if ((this.orderDetail.recyclinRemark=null&&this.orderDetail.recyclinRemark!=\"\")\r\n      ||(this.orderDetail.userRemark!=null&&this.orderDetail.userRemark!=\"\")){\r\n        return true;\r\n      }else {\r\n        return false;\r\n      }\r\n    },\r\n    //type=2  ---> 运输服务\r\n    isTrac: function(){\r\n      if(this.orderDetail.type==2){\r\n        return true;\r\n      }else{\r\n        return false;\r\n      }\r\n    },\r\n    urlsList: function() {\r\n      return this.orderDetail.imgUrls.split(\";\");\r\n    },\r\n    isManualFinish: function() {\r\n      if (this.orderDetail.status != 5 && this.orderDetail.status != 6) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n    CpType: function() {\r\n      if (this.orderDetail.type === 0) {\r\n        return \"可再生回收\";\r\n      } else if (this.orderDetail.type === 1) {\r\n        return \"付费回收\";\r\n      } else if (this.orderDetail.type === 2) {\r\n        return \"运输服务\";\r\n      }\r\n    },\r\n    // isPay: function() {\r\n    //   if (this.orderDetail.type === 0) {\r\n    //     //可再生垃圾回收是回收人员支付钱给用户\r\n    //     return false;\r\n    //   } else {\r\n    //     return true;\r\n    //   }\r\n    // },\r\n    isDispactched: function() {\r\n      if (\r\n        this.orderDetail.status === 0 ||\r\n        this.orderDetail.status === 1 ||\r\n        this.orderDetail.status === 3\r\n      ) {\r\n        return true;\r\n      } else return false;\r\n    },\r\n    isElevatorRoom: function() {\r\n      if (this.orderDetail.isElevatorRoom == 0) {\r\n        return \"是\";\r\n      } else if (this.orderDetail.isElevatorRoom == 1) {\r\n        return \"否\";\r\n      }\r\n    },\r\n    status: function() {\r\n      if (this.orderDetail.status == 0) {\r\n        return \"待分配\";\r\n      } else if (this.orderDetail.status == 1) {\r\n        return \"系统派单中\";\r\n      } else if (this.orderDetail.status == 2) {\r\n        return \"已接单\";\r\n      } else if (this.orderDetail.status == 3) {\r\n        return \"拒绝接单\";\r\n      } else if (this.orderDetail.status == 4) {\r\n        return \"待支付\";\r\n      } else if (this.orderDetail.status == 5) {\r\n        return \"已取消\";\r\n      } else if (this.orderDetail.status == 6) {\r\n        return \"已完成\";\r\n      }\r\n    },\r\n    type: function() {\r\n      if (this.orderDetail.type == 0) {\r\n        return \"可再生回收\";\r\n      } else if (this.orderDetail.type == 1) {\r\n        return \"付费回收\";\r\n      } else if (this.orderDetail.type == 2) {\r\n        return \"运输服务\";\r\n      }\r\n    },\r\n\r\n    //订单状态\r\n    //type=0的话用户是不需要支付的，是回收人员支付钱，故待支付为false\r\n    //状态：0待分配 1系统已派单,待接单 2已接单 3拒绝接单 4等待用户支付（付费回收才有） 5已取消 6已完成'  7已支付\r\n    whichSatatus: function() {\r\n      if (this.orderDetail.status == 0 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isFinish = true;\r\n        return 0;\r\n      } else if (this.orderDetail.status == 0 && !this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPayed = true;\r\n        this.isPay = true;\r\n        this.isFinish = true;\r\n        return 0;\r\n      } else if (this.orderDetail.status == 1 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPay = false;\r\n        this.isPayed = true;\r\n        this.isFinish = true;\r\n        return 1;\r\n      } else if (this.orderDetail.status == 1 && !this.orderDetail.type == 0) {\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isFinish = true;\r\n        return 1;\r\n      } else if (this.orderDetail.status == 2 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isFinish = true;\r\n        return 2;\r\n      } else if (this.orderDetail.status == 2 && !this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isCancel = false;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isFinish = true;\r\n        return 2;\r\n      } else if (this.orderDetail.status == 3 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isRefuse = true;\r\n        return 3;\r\n      } else if (this.orderDetail.status == 3 && !this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isRefuse = true;\r\n        return 3;\r\n      } else if (this.orderDetail.status == 4 && this.orderDetail.type == 0) {\r\n        //本身就是待支付状态\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isRefuse = false;\r\n        return 3; //因为拒绝接单被隐藏了  所以要显示待支付下标要-1\r\n      } else if (this.orderDetail.status == 4 && !this.orderDetail.type == 0) {\r\n        //本身就是待支付状态\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        return 3; //因为拒绝接单被隐藏了  所以要显示待支付下标要-1\r\n      } else if (this.orderDetail.status == 5 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = true;\r\n        this.isFinish = false;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isRefuse = false;\r\n        return 3;\r\n      } else if (this.orderDetail.status == 5 && !this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = true;\r\n        this.isFinish = false;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isRefuse = false;\r\n        return 5;\r\n      } else if (this.orderDetail.status == 6 && this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        this.isPay = false;\r\n        this.isPayed = false;\r\n        this.isRefuse = false;\r\n        return 3;\r\n      } else if (this.orderDetail.status == 6 && !this.orderDetail.type == 0) {\r\n        // console.log(this.orderDetail.status);\r\n\r\n        this.isRefuse = false;\r\n        this.isPay = true;\r\n        this.isPayed = false;\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        return 5;//已支付\r\n      } else if (this.orderDetail.status == 7) {\r\n        // console.log(this.orderDetail.status);\r\n        this.isRefuse = false;\r\n        this.isPay = true;\r\n        this.isPayed = true;\r\n        this.isCancel = false;\r\n        this.isFinish = true;\r\n        return 4;\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    back() {\r\n      this.$router.go(-1);\r\n    },\r\n    watchBigImg(v) {\r\n      this.imgModal = !this.imgModal;\r\n      this.bigImgUrl = v;\r\n    },\r\n    cancelDispactch() {\r\n      this.dispatchModalVisible = false;\r\n    },\r\n    manualFinish() {\r\n      this.$Modal.confirm({\r\n        title: \"确认完成\",\r\n        content: \"确认人工完成订单\" + this.orderDetail.orderId + \"吗？\",\r\n        onOk: () => {\r\n          manualFinishOrder(this.orderDetail).then(res => {\r\n            if (res.success === true) {\r\n              this.$Message.success(\"订单已完成!\");\r\n              location.reload();\r\n            } else if (res.success === false) {\r\n              this.$Message.error(res.message + \"错误代码:\" + res.code);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    //选择了一个回收人员  赋值给请求参数\r\n    selectRc(currentRow, oldCurrentRow) {\r\n      this.dispatchForm.orderId = this.orderDetail.orderId;\r\n      this.dispatchForm.RecyclingPersonnelId = currentRow.id;\r\n      this.dispatchForm.RecyclingPersonnelName = currentRow.name;\r\n    },\r\n    comfirmDispactch() {\r\n      if (\r\n        this.dispatchForm.RecyclingPersonnelName != \"\" &&\r\n        this.dispatchForm.RecyclingPersonnelName != null\r\n      ) {\r\n        this.$Modal.confirm({\r\n          title: \"确认分配\",\r\n          content:\r\n            \"您确认要分配订单给\" +\r\n            this.dispatchForm.RecyclingPersonnelName +\r\n            \"?\",\r\n          onOk: () => {\r\n            dispatchOrder(this.dispatchForm).then(res => {\r\n              if (res.success === true) {\r\n                this.dispatchModalVisible = false;\r\n                location.reload();\r\n              }\r\n            });\r\n            this.confirmDialog = true;\r\n          }\r\n        });\r\n      } else {\r\n        this.$Message.error(\"请选择人员\");\r\n      }\r\n    },\r\n\r\n    //发起请求通过订单号获取订单商品明细\r\n    getOrderDetailMethod() {\r\n      this.orderDetailForm.id = this.orderDetail.id;\r\n      this.orderDetailForm.orderId = this.orderDetail.orderId;\r\n      getOrderDetail(this.orderDetailForm).then(res => {\r\n        if (res.success === true) {\r\n          if (res.result.orderGoodsList != null) {\r\n            this.OrderGoodsList = res.result.orderGoodsList;\r\n          }\r\n          this.orderDetail = res.result; //传数据渲染\r\n         \r\n        }\r\n      });\r\n    },\r\n\r\n    // 人工派单的逻辑方法\r\n    dispatchOrderDialog() {\r\n      this.dispatchModalVisible = true; //弹出对话框\r\n\r\n      //发送请求获取所有在线的回收人员\r\n      getOnlineRp().then(res => {\r\n        if (res.success === true) {\r\n          this.RecyclingPersonnel = res.result;\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  //渲染完毕\r\n  mounted() {\r\n    this.getOrderDetailMethod(); //获取订单详情\r\n  },\r\n\r\n  //组件加载完毕\r\n  created() {\r\n    var data = this.$route.query.orderData;\r\n    // if (data != null && data != undefined && data.orderId != undefined) {\r\n    //   this.orderDetail = data;\r\n    //   this.setStore(\"orderDetail\", JSON.stringify(data));\r\n    // } else {\r\n    //   this.orderDetail = JSON.parse(this.getStore(\"orderDetail\") || \"{}\");\r\n    //   console.log(\"缓存取出orderDetail\");\r\n    // console.log(this.orderDetail);\r\n    // }\r\n\r\n    if (data != null && data != undefined && data.orderId != undefined) {\r\n      this.orderDetail = data;\r\n      this.setStore(\"orderId\", data.orderId);\r\n      this.setStore(\"id\", data.id);\r\n    } else {\r\n      this.orderDetail.id = this.getStore(\"id\");\r\n      this.orderDetail.orderId = this.getStore(\"orderId\");\r\n    }\r\n  }\r\n};\r\n",null]}