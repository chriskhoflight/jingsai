{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\common\\own-space\\own-space.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\common\\own-space\\own-space.vue","mtime":1564969187174},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  userInfoEdit,\r\n  relatedInfo,\r\n  unRelate,\r\n  githubLogin,\r\n  qqLogin,\r\n  weiboLogin,\r\n  uploadFile,\r\n  getDictDataByType\r\n} from \"@/api/index\";\r\nimport Cookies from \"js-cookie\";\r\nexport default {\r\n  name: \"ownspace_index\",\r\n  data() {\r\n    const validePhone = (rule, value, callback) => {\r\n      var re = /^1[0-9]{10}$/;\r\n      if (!re.test(value)) {\r\n        callback(new Error(\"请输入正确格式的手机号\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      accessToken: {},\r\n      uploadFileUrl: uploadFile,\r\n      userForm: {\r\n        id: \"\",\r\n        avatar: \"\",\r\n        username: \"\",\r\n        sex: \"\",\r\n        mobile: \"\",\r\n        email: \"\",\r\n        status: \"\",\r\n        type: \"\",\r\n        typeTxt: \"\",\r\n        address: \"\",\r\n        addressArray: []\r\n      },\r\n      mobileEditForm: {\r\n        mobile: \"\",\r\n        code: \"\"\r\n      },\r\n      emailEditForm: {\r\n        email: \"\"\r\n      },\r\n      defaultList: [\r\n        {\r\n          url: \"\"\r\n        }\r\n      ],\r\n      uploadList: [],\r\n      viewImage: false,\r\n      imgUrl: \"\",\r\n      codeError: \"\",\r\n      initPhone: \"\",\r\n      initEmail: \"\",\r\n      uid: \"\", // 登录用户的userId\r\n      saveLoading: false,\r\n      identifyError: \"\", // 验证码错误\r\n      savePassLoading: false,\r\n      oldPassError: \"\",\r\n      identifyCodeRight: false, // 验证码是否正确\r\n      hasGetIdentifyCode: false, // 是否点了获取验证码\r\n      canGetIdentifyCode: false, // 是否可点获取验证码\r\n      checkIdentifyCodeLoading: false,\r\n      mobileEditValidate: {\r\n        mobile: [\r\n          { required: true, message: \"请输入手机号码\" },\r\n          { validator: validePhone }\r\n        ]\r\n      },\r\n      emailEditValidate: {\r\n        email: [\r\n          { required: true, message: \"请输入邮箱地址\" },\r\n          { type: \"email\", message: \"邮箱格式不正确\" }\r\n        ]\r\n      },\r\n      editMobileVisible: false, // 显示填写验证码box\r\n      gettingIdentifyCodeBtnContent: \"获取验证码\", // “获取验证码”按钮的文字\r\n      editEmailVisible: false,\r\n      sendVerifyEmailLoading: false,\r\n      canSendEditEmail: true,\r\n      github: {\r\n        related: false,\r\n        id: \"\",\r\n        username: \"\"\r\n      },\r\n      qq: {\r\n        related: false,\r\n        id: \"\",\r\n        username: \"\"\r\n      },\r\n      weibo: {\r\n        related: false,\r\n        id: \"\",\r\n        username: \"\"\r\n      },\r\n      jumping: false,\r\n      dictSex: []\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getDictSexData();\r\n      this.accessToken = {\r\n        accessToken: this.getStore(\"accessToken\")\r\n      };\r\n      let v = JSON.parse(Cookies.get(\"userInfo\"));\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] === null) {\r\n          v[attr] = \"\";\r\n        }\r\n      }\r\n      let str = JSON.stringify(v);\r\n      let userInfo = JSON.parse(str);\r\n      userInfo.addressArray = [];\r\n      this.userForm = userInfo;\r\n      this.initPhone = userInfo.mobile;\r\n      this.mobileEditForm.mobile = userInfo.mobile;\r\n      this.initEmail = userInfo.email;\r\n      this.emailEditForm.email = userInfo.email;\r\n      this.defaultList[0].url = userInfo.avatar;\r\n      if (userInfo.address !== null && userInfo.address !== \"\") {\r\n        this.userForm.address = userInfo.address;\r\n        this.userForm.addressArray = JSON.parse(userInfo.address);\r\n      }\r\n      if (this.userForm.type === 0) {\r\n        this.userForm.typeTxt = \"普通用户\";\r\n      } else if (this.userForm.type === 1) {\r\n        this.userForm.typeTxt = \"管理员\";\r\n      }\r\n    },\r\n    getDictSexData(){\r\n      // 获取性别字典数据\r\n      getDictDataByType(\"sex\").then(res => {\r\n        if(res.success){\r\n          this.dictSex = res.result\r\n        }\r\n      })\r\n    },\r\n    handleView(imgUrl) {\r\n      this.imgUrl = imgUrl;\r\n      this.viewImage = true;\r\n    },\r\n    handleRemove(file) {\r\n      const fileList = this.$refs.upload.fileList;\r\n      this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);\r\n    },\r\n    handleSuccess(res, file) {\r\n      if (res.success === true) {\r\n        file.url = res.result;\r\n        this.userForm.avatar = res.result;\r\n        this.defaultList[0].url = res.result;\r\n        this.$refs.upload.fileList.splice(0, 1);\r\n      } else {\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    handleError(error, file, fileList) {\r\n      this.$Message.error(error.toString());\r\n    },\r\n    handleFormatError(file) {\r\n      this.$Notice.warning({\r\n        title: \"不支持的文件格式\",\r\n        desc:\r\n          \"所选文件‘ \" +\r\n          file.name +\r\n          \" ’格式不正确, 请选择 .jpg .jpeg .png .gif格式文件\"\r\n      });\r\n    },\r\n    handleMaxSize(file) {\r\n      this.$Notice.warning({\r\n        title: \"文件大小过大\",\r\n        desc: \"所选文件‘ \" + file.name + \" ’大小过大, 不得超过 5M.\"\r\n      });\r\n    },\r\n    handleBeforeUpload() {\r\n      const check = this.uploadList.length < 2;\r\n      if (!check) {\r\n        this.$Notice.warning({\r\n          title: \"最多只能上传 1 张图片\"\r\n        });\r\n      }\r\n      return check;\r\n    },\r\n    showChangeMobile() {\r\n      this.editMobileVisible = true;\r\n    },\r\n    showChangeEmail() {\r\n      this.editEmailVisible = true;\r\n    },\r\n    getIdentifyCode() {\r\n      this.hasGetIdentifyCode = true;\r\n      this.$refs[\"mobileEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          this.canGetIdentifyCode = true;\r\n          let timeLast = 60;\r\n          let timer = setInterval(() => {\r\n            if (timeLast >= 0) {\r\n              this.gettingIdentifyCodeBtnContent = timeLast + \"秒后重试\";\r\n              timeLast -= 1;\r\n            } else {\r\n              clearInterval(timer);\r\n              this.gettingIdentifyCodeBtnContent = \"获取验证码\";\r\n              this.canGetIdentifyCode = false;\r\n            }\r\n          }, 1000);\r\n          this.editMobileVisible = true;\r\n          // you can write ajax request here\r\n        }\r\n      });\r\n    },\r\n    cancelEditUserInfo() {\r\n      this.$store.commit(\"removeTag\", \"ownspace_old\");\r\n      localStorage.pageOpenedList = JSON.stringify(\r\n        this.$store.state.app.pageOpenedList\r\n      );\r\n      let lastPageName = \"\";\r\n      let length = this.$store.state.app.pageOpenedList.length;\r\n      if (length > 1) {\r\n        lastPageName = this.$store.state.app.pageOpenedList[length - 1].name;\r\n      } else {\r\n        lastPageName = this.$store.state.app.pageOpenedList[0].name;\r\n      }\r\n      this.$router.push({\r\n        name: lastPageName\r\n      });\r\n    },\r\n    saveEdit() {\r\n      this.saveLoading = true;\r\n      let params = this.userForm;\r\n      delete params.nickName;\r\n      delete params.description;\r\n      userInfoEdit(params).then(res => {\r\n        this.saveLoading = false;\r\n        if (res.success === true) {\r\n          this.$Message.success(\"保存成功\");\r\n          // 更新用户信息\r\n          Cookies.set(\"userInfo\", this.userForm);\r\n          // 更新头像\r\n          this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\r\n        }\r\n      });\r\n    },\r\n    changeAddress() {\r\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\r\n    },\r\n    cancelInputCodeBox() {\r\n      this.editMobileVisible = false;\r\n      this.userForm.mobile = this.initPhone;\r\n    },\r\n    cancelEditEmail() {\r\n      this.editEmailVisible = false;\r\n      this.emailEditForm.email = this.initEmail;\r\n    },\r\n    submitCode() {\r\n      this.checkIdentifyCodeLoading = true;\r\n      this.$refs[\"mobileEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          if (this.mobileEditForm.code.length === 0) {\r\n            this.codeError = \"请填写短信验证码\";\r\n            this.checkIdentifyCodeLoading = false;\r\n            return;\r\n          } else {\r\n            this.$Message.success(\"修改成功\");\r\n            this.editMobileVisible = false;\r\n            this.checkIdentifyCodeLoading = false;\r\n          }\r\n        }\r\n      });\r\n    },\r\n    hasChangePhone() {\r\n      if (this.mobileEditForm.mobile === this.initPhone) {\r\n        this.canGetIdentifyCode = true;\r\n      } else {\r\n        this.$refs[\"mobileEditForm\"].validate(valid => {\r\n          if (valid) {\r\n            this.canGetIdentifyCode = false;\r\n          } else {\r\n            this.canGetIdentifyCode = true;\r\n          }\r\n        });\r\n      }\r\n    },\r\n    hasChangeEmail() {\r\n      if (this.emailEditForm.email === this.initEmail) {\r\n        this.canSendEditEmail = true;\r\n      } else {\r\n        this.canSendEditEmail = false;\r\n      }\r\n    },\r\n    sendVerifyEmail() {\r\n      this.$refs[\"emailEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          this.sendVerifyEmailLoading = true;\r\n          setTimeout(() => {\r\n            this.sendVerifyEmailLoading = false;\r\n            this.editEmailVisible = false;\r\n            this.$Message.success(\"发送验证邮件成功，请注意查收\");\r\n          }, 1000);\r\n        }\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    this.uploadList = this.$refs.upload.fileList;\r\n    this.init();\r\n    this.hasChangePhone();\r\n  }\r\n};\r\n",null]}