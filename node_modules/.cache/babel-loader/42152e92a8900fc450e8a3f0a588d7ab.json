{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\common\\own-space\\own-space.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\common\\own-space\\own-space.vue","mtime":1564969187174},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { userInfoEdit, relatedInfo, unRelate, githubLogin, qqLogin, weiboLogin, uploadFile, getDictDataByType } from \"@/api/index\";\nimport Cookies from \"js-cookie\";\nexport default {\n  name: \"ownspace_index\",\n  data: function data() {\n    var validePhone = function validePhone(rule, value, callback) {\n      var re = /^1[0-9]{10}$/;\n\n      if (!re.test(value)) {\n        callback(new Error(\"请输入正确格式的手机号\"));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      accessToken: {},\n      uploadFileUrl: uploadFile,\n      userForm: {\n        id: \"\",\n        avatar: \"\",\n        username: \"\",\n        sex: \"\",\n        mobile: \"\",\n        email: \"\",\n        status: \"\",\n        type: \"\",\n        typeTxt: \"\",\n        address: \"\",\n        addressArray: []\n      },\n      mobileEditForm: {\n        mobile: \"\",\n        code: \"\"\n      },\n      emailEditForm: {\n        email: \"\"\n      },\n      defaultList: [{\n        url: \"\"\n      }],\n      uploadList: [],\n      viewImage: false,\n      imgUrl: \"\",\n      codeError: \"\",\n      initPhone: \"\",\n      initEmail: \"\",\n      uid: \"\",\n      // 登录用户的userId\n      saveLoading: false,\n      identifyError: \"\",\n      // 验证码错误\n      savePassLoading: false,\n      oldPassError: \"\",\n      identifyCodeRight: false,\n      // 验证码是否正确\n      hasGetIdentifyCode: false,\n      // 是否点了获取验证码\n      canGetIdentifyCode: false,\n      // 是否可点获取验证码\n      checkIdentifyCodeLoading: false,\n      mobileEditValidate: {\n        mobile: [{\n          required: true,\n          message: \"请输入手机号码\"\n        }, {\n          validator: validePhone\n        }]\n      },\n      emailEditValidate: {\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\"\n        }]\n      },\n      editMobileVisible: false,\n      // 显示填写验证码box\n      gettingIdentifyCodeBtnContent: \"获取验证码\",\n      // “获取验证码”按钮的文字\n      editEmailVisible: false,\n      sendVerifyEmailLoading: false,\n      canSendEditEmail: true,\n      github: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      qq: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      weibo: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      jumping: false,\n      dictSex: []\n    };\n  },\n  methods: {\n    init: function init() {\n      this.getDictSexData();\n      this.accessToken = {\n        accessToken: this.getStore(\"accessToken\")\n      };\n      var v = JSON.parse(Cookies.get(\"userInfo\")); // 转换null为\"\"\n\n      for (var attr in v) {\n        if (v[attr] === null) {\n          v[attr] = \"\";\n        }\n      }\n\n      var str = JSON.stringify(v);\n      var userInfo = JSON.parse(str);\n      userInfo.addressArray = [];\n      this.userForm = userInfo;\n      this.initPhone = userInfo.mobile;\n      this.mobileEditForm.mobile = userInfo.mobile;\n      this.initEmail = userInfo.email;\n      this.emailEditForm.email = userInfo.email;\n      this.defaultList[0].url = userInfo.avatar;\n\n      if (userInfo.address !== null && userInfo.address !== \"\") {\n        this.userForm.address = userInfo.address;\n        this.userForm.addressArray = JSON.parse(userInfo.address);\n      }\n\n      if (this.userForm.type === 0) {\n        this.userForm.typeTxt = \"普通用户\";\n      } else if (this.userForm.type === 1) {\n        this.userForm.typeTxt = \"管理员\";\n      }\n    },\n    getDictSexData: function getDictSexData() {\n      var _this = this;\n\n      // 获取性别字典数据\n      getDictDataByType(\"sex\").then(function (res) {\n        if (res.success) {\n          _this.dictSex = res.result;\n        }\n      });\n    },\n    handleView: function handleView(imgUrl) {\n      this.imgUrl = imgUrl;\n      this.viewImage = true;\n    },\n    handleRemove: function handleRemove(file) {\n      var fileList = this.$refs.upload.fileList;\n      this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);\n    },\n    handleSuccess: function handleSuccess(res, file) {\n      if (res.success === true) {\n        file.url = res.result;\n        this.userForm.avatar = res.result;\n        this.defaultList[0].url = res.result;\n        this.$refs.upload.fileList.splice(0, 1);\n      } else {\n        this.$Message.error(res.message);\n      }\n    },\n    handleError: function handleError(error, file, fileList) {\n      this.$Message.error(error.toString());\n    },\n    handleFormatError: function handleFormatError(file) {\n      this.$Notice.warning({\n        title: \"不支持的文件格式\",\n        desc: \"所选文件‘ \" + file.name + \" ’格式不正确, 请选择 .jpg .jpeg .png .gif格式文件\"\n      });\n    },\n    handleMaxSize: function handleMaxSize(file) {\n      this.$Notice.warning({\n        title: \"文件大小过大\",\n        desc: \"所选文件‘ \" + file.name + \" ’大小过大, 不得超过 5M.\"\n      });\n    },\n    handleBeforeUpload: function handleBeforeUpload() {\n      var check = this.uploadList.length < 2;\n\n      if (!check) {\n        this.$Notice.warning({\n          title: \"最多只能上传 1 张图片\"\n        });\n      }\n\n      return check;\n    },\n    showChangeMobile: function showChangeMobile() {\n      this.editMobileVisible = true;\n    },\n    showChangeEmail: function showChangeEmail() {\n      this.editEmailVisible = true;\n    },\n    getIdentifyCode: function getIdentifyCode() {\n      var _this2 = this;\n\n      this.hasGetIdentifyCode = true;\n      this.$refs[\"mobileEditForm\"].validate(function (valid) {\n        if (valid) {\n          _this2.canGetIdentifyCode = true;\n          var timeLast = 60;\n          var timer = setInterval(function () {\n            if (timeLast >= 0) {\n              _this2.gettingIdentifyCodeBtnContent = timeLast + \"秒后重试\";\n              timeLast -= 1;\n            } else {\n              clearInterval(timer);\n              _this2.gettingIdentifyCodeBtnContent = \"获取验证码\";\n              _this2.canGetIdentifyCode = false;\n            }\n          }, 1000);\n          _this2.editMobileVisible = true; // you can write ajax request here\n        }\n      });\n    },\n    cancelEditUserInfo: function cancelEditUserInfo() {\n      this.$store.commit(\"removeTag\", \"ownspace_old\");\n      localStorage.pageOpenedList = JSON.stringify(this.$store.state.app.pageOpenedList);\n      var lastPageName = \"\";\n      var length = this.$store.state.app.pageOpenedList.length;\n\n      if (length > 1) {\n        lastPageName = this.$store.state.app.pageOpenedList[length - 1].name;\n      } else {\n        lastPageName = this.$store.state.app.pageOpenedList[0].name;\n      }\n\n      this.$router.push({\n        name: lastPageName\n      });\n    },\n    saveEdit: function saveEdit() {\n      var _this3 = this;\n\n      this.saveLoading = true;\n      var params = this.userForm;\n      delete params.nickName;\n      delete params.description;\n      userInfoEdit(params).then(function (res) {\n        _this3.saveLoading = false;\n\n        if (res.success === true) {\n          _this3.$Message.success(\"保存成功\"); // 更新用户信息\n\n\n          Cookies.set(\"userInfo\", _this3.userForm); // 更新头像\n\n          _this3.$store.commit(\"setAvatarPath\", _this3.userForm.avatar);\n        }\n      });\n    },\n    changeAddress: function changeAddress() {\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\n    },\n    cancelInputCodeBox: function cancelInputCodeBox() {\n      this.editMobileVisible = false;\n      this.userForm.mobile = this.initPhone;\n    },\n    cancelEditEmail: function cancelEditEmail() {\n      this.editEmailVisible = false;\n      this.emailEditForm.email = this.initEmail;\n    },\n    submitCode: function submitCode() {\n      var _this4 = this;\n\n      this.checkIdentifyCodeLoading = true;\n      this.$refs[\"mobileEditForm\"].validate(function (valid) {\n        if (valid) {\n          if (_this4.mobileEditForm.code.length === 0) {\n            _this4.codeError = \"请填写短信验证码\";\n            _this4.checkIdentifyCodeLoading = false;\n            return;\n          } else {\n            _this4.$Message.success(\"修改成功\");\n\n            _this4.editMobileVisible = false;\n            _this4.checkIdentifyCodeLoading = false;\n          }\n        }\n      });\n    },\n    hasChangePhone: function hasChangePhone() {\n      var _this5 = this;\n\n      if (this.mobileEditForm.mobile === this.initPhone) {\n        this.canGetIdentifyCode = true;\n      } else {\n        this.$refs[\"mobileEditForm\"].validate(function (valid) {\n          if (valid) {\n            _this5.canGetIdentifyCode = false;\n          } else {\n            _this5.canGetIdentifyCode = true;\n          }\n        });\n      }\n    },\n    hasChangeEmail: function hasChangeEmail() {\n      if (this.emailEditForm.email === this.initEmail) {\n        this.canSendEditEmail = true;\n      } else {\n        this.canSendEditEmail = false;\n      }\n    },\n    sendVerifyEmail: function sendVerifyEmail() {\n      var _this6 = this;\n\n      this.$refs[\"emailEditForm\"].validate(function (valid) {\n        if (valid) {\n          _this6.sendVerifyEmailLoading = true;\n          setTimeout(function () {\n            _this6.sendVerifyEmailLoading = false;\n            _this6.editEmailVisible = false;\n\n            _this6.$Message.success(\"发送验证邮件成功，请注意查收\");\n          }, 1000);\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.uploadList = this.$refs.upload.fileList;\n    this.init();\n    this.hasChangePhone();\n  }\n};",null]}