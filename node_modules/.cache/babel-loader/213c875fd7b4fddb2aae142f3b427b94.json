{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\wechat\\account-manage\\accountManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\wechat\\account-manage\\accountManage.vue","mtime":1564969187252},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAccountPage, addAccount, editAccount, delAccount, getWxMenu, createWxMenu, getAllMenuTemplate } from \"@/api/wechat\";\nimport { getDictDataByType } from \"@/api/index\";\nimport { debug } from 'util';\nexport default {\n  name: \"builder-code\",\n  components: {},\n  data: function data() {\n    var _this = this;\n\n    return {\n      loading: true,\n      operationLoading: false,\n      selectCount: 0,\n      selectList: [],\n      searchKey: \"\",\n      searchForm: {\n        pageNumber: 1,\n        pageSize: 10,\n        sort: \"createTime\",\n        order: \"desc\",\n        name: \"\",\n        appid: \"\",\n        type: null\n      },\n      //窗口\n      modalType: 0,\n      modalVisible: false,\n      modalTitle: \"\",\n      formItem: {\n        name: '',\n        description: '',\n        type: 2,\n        appid: '',\n        aeskey: '',\n        secret: '',\n        token: ''\n      },\n      formItemValidate: {\n        name: [{\n          required: true,\n          message: \"公众号名称不能为空\",\n          trigger: \"blur\"\n        }],\n        appid: [{\n          required: true,\n          message: \"AppID不能为空\",\n          trigger: \"blur\"\n        }],\n        aeskey: [{\n          required: true,\n          message: \"EncodingAESKey不能为空\",\n          trigger: \"blur\"\n        }],\n        secret: [{\n          required: true,\n          message: \"AppSecret不能为空\",\n          trigger: \"blur\"\n        }],\n        token: [{\n          required: true,\n          message: \"令牌(Token)不能为空\",\n          trigger: \"blur\"\n        }]\n      },\n      submitLoading: false,\n      //table 列表字段\n      columns: [{\n        type: \"selection\",\n        width: 60,\n        align: \"center\",\n        fixed: \"left\"\n      }, {\n        type: \"index\",\n        width: 60,\n        align: \"center\"\n      }, {\n        title: \"公众号名称\",\n        key: \"name\",\n        minWidth: 120,\n        sortable: true\n      }, {\n        title: \"公众号类型\",\n        key: \"type\",\n        width: 115,\n        sortable: true,\n        render: function render(h, params) {\n          var re = \"\"; //公众号类型：1-订阅号 2-服务号 3-企业号\n\n          if (params.row.type === 1) {\n            re = \"订阅号\";\n          } else if (params.row.type === 2) {\n            re = \"服务号\";\n          } else if (params.row.type === 3) {\n            re = \"企业号\";\n          }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"AppID\",\n        key: \"appid\",\n        align: \"center\",\n        minWidth: 160\n      }, {\n        title: \"AppSecret\",\n        key: \"secret\",\n        minWidth: 250\n      }, {\n        title: \"令牌(Token)\",\n        key: \"token\",\n        minWidth: 120\n      }, {\n        title: \"EncodingAESKey\",\n        key: \"aeskey\",\n        minWidth: 360\n      }, {\n        title: \"描述\",\n        key: \"description\",\n        minWidth: 100\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\",\n        width: 150\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        width: 280,\n        align: \"center\",\n        fixed: \"right\",\n        render: function render(h, params) {\n          return h(\"div\", [h(\"Button\", {\n            props: {\n              type: \"primary\",\n              size: \"small\"\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.edit(params.row);\n              }\n            }\n          }, \"编辑\"), h(\"Button\", {\n            props: {\n              type: \"error\",\n              size: \"small\"\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.remove(params.row);\n              }\n            }\n          }, \"解绑\"), h(\"Button\", {\n            props: {\n              type: \"info\",\n              size: \"small\"\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.createMenu(params.row);\n              }\n            }\n          }, \"发布菜单\"), h(\"Button\", {\n            props: {\n              type: \"success\",\n              size: \"small\"\n            },\n            on: {\n              click: function click() {\n                _this.getMenu(params.row);\n              }\n            }\n          }, \"查看菜单\")]);\n        }\n      }],\n      data: [],\n      total: 0,\n      dictAccountType: [],\n      //查看公众号菜单窗口\n      menuModalVisible: false,\n      menuModalTitle: \"\",\n      menuData: [],\n      //发布公众号菜单窗口\n      createMenuModalVisible: false,\n      createMenuModalTitle: \"\",\n      templateData: [],\n      createMenuForm: {\n        name: \"\",\n        appid: \"\",\n        templateId: \"\"\n      },\n      createMenuFormValidate: {\n        templateId: [{\n          required: true,\n          message: \"请选择菜单模版\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  methods: {\n    init: function init() {\n      this.getList();\n      this.getDictAccountTypeData();\n      this.loadTemplates();\n    },\n    //加载数字字典\n    getDictAccountTypeData: function getDictAccountTypeData() {\n      var _this2 = this;\n\n      // 获取性别字典数据\n      getDictDataByType(\"wx_account_type\").then(function (res) {\n        if (res.success) {\n          _this2.dictAccountType = res.result;\n        }\n      });\n    },\n    //加载模版\n    loadTemplates: function loadTemplates() {\n      var _this3 = this;\n\n      getAllMenuTemplate().then(function (res) {\n        if (res.success) {\n          _this3.templateData = res.result;\n        }\n      });\n    },\n    //翻页\n    changePage: function changePage(v) {\n      this.searchForm.pageNumber = v;\n      this.getList();\n      this.clearSelectAll();\n    },\n    //每页条数\n    changePageSize: function changePageSize(v) {\n      this.searchForm.pageSize = v;\n      this.getList();\n    },\n    //排序\n    changeSort: function changeSort(e) {\n      this.searchForm.sort = e.key;\n      this.searchForm.order = e.order;\n\n      if (e.order === \"normal\") {\n        this.searchForm.order = \"\";\n      }\n\n      this.getList();\n    },\n    showSelect: function showSelect(e) {\n      this.exportData = e;\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    //清空\n    clearSelectAll: function clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    },\n    //搜索\n    handleSearch: function handleSearch() {\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.getList();\n    },\n    //重置\n    handleReset: function handleReset() {\n      this.$refs.searchForm.resetFields();\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10; // 重新加载数据\n\n      this.getList();\n    },\n    //查询列表\n    getList: function getList() {\n      var _this4 = this;\n\n      // 多条件搜索用户列表\n      this.loading = true;\n      getAccountPage(this.searchForm).then(function (res) {\n        _this4.loading = false;\n\n        if (res.success === true) {\n          _this4.data = res.result.content;\n          _this4.total = res.result.totalElements;\n        }\n      });\n    },\n    //新增按钮操作\n    add: function add() {\n      this.modalType = 0;\n      this.modalTitle = \"绑定公众号\";\n      this.$refs.formItem.resetFields();\n      this.modalVisible = true;\n    },\n    //编辑\n    edit: function edit(v) {\n      this.modalType = 1;\n      this.modalTitle = \"编辑公众号\";\n      this.$refs.formItem.resetFields(); // 转换null为\"\"\n\n      for (var attr in v) {\n        if (v[attr] === null) {\n          v[attr] = \"\";\n        }\n      }\n\n      var str = JSON.stringify(v);\n      var data = JSON.parse(str);\n      this.formItem = data;\n      this.modalVisible = true;\n    },\n    //取消\n    cancelBt: function cancelBt() {\n      this.modalVisible = false;\n    },\n    //提交\n    submitBt: function submitBt() {\n      var _this5 = this;\n\n      this.$refs.formItem.validate(function (valid) {\n        if (valid) {\n          //添加\n          if (_this5.modalType === 0) {\n            // 添加 避免编辑后传入id\n            delete _this5.formItem.id;\n            _this5.submitLoading = true;\n            addAccount(_this5.formItem).then(function (res) {\n              _this5.submitLoading = false;\n\n              if (res.success === true) {\n                _this5.$Message.success(res.message);\n\n                _this5.getList();\n\n                _this5.modalVisible = false;\n              }\n            });\n          } else {\n            // 编辑\n            _this5.submitLoading = true;\n            editAccount(_this5.formItem).then(function (res) {\n              _this5.submitLoading = false;\n\n              if (res.success === true) {\n                _this5.$Message.success(\"操作成功\");\n\n                _this5.getList();\n\n                _this5.modalVisible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    //查看公众号菜单\n    getMenu: function getMenu(v) {\n      var _this6 = this;\n\n      var id = v.appid;\n      this.loading = true;\n      getWxMenu(id).then(function (res) {\n        _this6.loading = false;\n\n        if (res.success === true) {\n          _this6.menuData = res.result.menu.buttons;\n        }\n      });\n      this.menuModalTitle = \"公众号菜单\";\n      this.menuModalVisible = true;\n    },\n    menuCancelBt: function menuCancelBt() {\n      this.menuModalVisible = false;\n    },\n    //发布公众号菜单\n    createMenu: function createMenu(v) {\n      this.createMenuForm.appid = v.appid;\n      this.createMenuForm.name = v.name;\n      this.createMenuModalTitle = \"发布菜单\";\n      this.createMenuModalVisible = true;\n    },\n    createMenuCancelBt: function createMenuCancelBt() {\n      this.createMenuModalVisible = false;\n    },\n    createMenusubmitBt: function createMenusubmitBt() {\n      var _this7 = this;\n\n      this.$refs.createMenuForm.validate(function (valid) {\n        if (valid) {\n          _this7.submitLoading = true;\n          createWxMenu(_this7.createMenuForm).then(function (res) {\n            _this7.submitLoading = false;\n\n            if (res.success === true) {\n              _this7.$Message.success(res.message);\n\n              _this7.getList();\n\n              _this7.createMenuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    //批量删除\n    delAll: function delAll() {\n      var _this8 = this;\n\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未选择要解绑的公众号\");\n        return;\n      }\n\n      this.$Modal.confirm({\n        title: \"确认解绑\",\n        content: \"您确认要解绑所选的 \" + this.selectCount + \" 条数据?\",\n        onOk: function onOk() {\n          var ids = \"\";\n\n          _this8.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n\n          ids = ids.substring(0, ids.length - 1);\n          _this8.operationLoading = true;\n          delAccount(ids).then(function (res) {\n            _this8.operationLoading = false;\n\n            if (res.success === true) {\n              _this8.$Message.success(\"解绑成功\");\n\n              _this8.clearSelectAll();\n\n              _this8.getList();\n            }\n          });\n        }\n      });\n    },\n    //单个删除\n    remove: function remove(v) {\n      var _this9 = this;\n\n      this.$Modal.confirm({\n        title: \"确认解绑\",\n        content: \"您确认要解绑公众号【\" + v.name + \"】?\",\n        onOk: function onOk() {\n          _this9.operationLoading = true;\n          delAccount(v.id).then(function (res) {\n            _this9.operationLoading = false;\n\n            if (res.success === true) {\n              _this9.$Message.success(\"解绑成功\");\n\n              _this9.getList();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n  }\n};",null]}