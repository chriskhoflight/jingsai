{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\orders-manage\\ordersManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\orders-manage\\ordersManage.vue","mtime":1566557265779},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { addOneOrder, getAllOrders, delOneOrder, cancelOneOrder, getAlarm } from \"@/api/orders\";\nimport { getUserListData, getAllRoleList, getAllUserData, getDictDataByType } from \"@/api/index\";\nimport expandRow from \"./expand.vue\";\nimport departmentChoose from \"@/views/components/custom/department-choose\";\nimport departmentTreeChoose from \"@/views/components/custom/department-tree-choose\";\nimport uploadPicInput from \"@/views/components/custom/upload-pic-input\";\nimport circleLoading from \"@/views/components/custom/circle-loading.vue\";\nexport default {\n  name: \"user-manage\",\n  components: {\n    circleLoading: circleLoading,\n    expandRow: expandRow,\n    departmentChoose: departmentChoose,\n    departmentTreeChoose: departmentTreeChoose,\n    uploadPicInput: uploadPicInput\n  },\n  data: function data() {\n    var _this = this;\n\n    var validatePassword = function validatePassword(rule, value, callback) {\n      if (value.length < 6) {\n        callback(new Error(\"密码长度不得小于6位\"));\n      } else {\n        callback();\n      }\n    };\n\n    var validateMobile = function validateMobile(rule, value, callback) {\n      var reg = /^[1][3,4,5,7,8][0-9]{9}$/;\n\n      if (!reg.test(value)) {\n        callback(new Error(\"手机号格式错误\"));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      orderCount: 0,\n      //总订单数\n      count: 0,\n      //决定是否显示代办事项的红点\n      manualCount: 0,\n      allCount: 0,\n      alarmModalVisible: false,\n      //待办事项的显示\n      //待办事项\n      pStyle: {\n        fontSize: \"16px\",\n        color: \"rgba(0,0,0,0.85)\",\n        lineHeight: \"24px\",\n        display: \"block\",\n        marginBottom: \"16px\"\n      },\n      loading: true,\n      operationLoading: false,\n      loadingExport: true,\n      modalExportAll: false,\n      drop: false,\n      // dropDownContent: \"展开\",\n      // dropDownIcon: \"ios-arrow-down\",\n      selectCount: 0,\n      selectList: [],\n      dataDep: [],\n      searchKey: \"\",\n      searchForm: {\n        isManual: -1,\n        //派单方式  0 为自动派单  1为人工派单\n        payType: -1,\n        phone: \"\",\n        //回收人员手机号码\n        orderId: \"\",\n        type: -1,\n        //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\n        contactsPhone: \"\",\n        status: -1,\n        //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\n        pageNumber: 1,\n        pageSize: 10,\n        sort: \"createTime\",\n        order: \"desc\",\n        startDate: \"\",\n        endDate: \"\"\n      },\n      selectDate: null,\n      modalType: 0,\n      userModalVisible: false,\n      modalTitle: \"\",\n      userForm: {\n        appointmentDay: \"\",\n        appointmentStartTime: \"\",\n        appointmentEndTime: \"\",\n        userId: \"\",\n        type: -1,\n        recyclingPersonId: \"\",\n        contactsName: \"\",\n        contactsPhone: \"\",\n        contactsAdderss: \"\",\n        contactsFloor: 0,\n        isElevatorRoom: -1,\n        longitude: 0,\n        latitude: 0,\n        mileage: 0,\n        orderId: \"\",\n        estimatedPrice: 0,\n        paidPrice: 0,\n        status: -1,\n        payType: -1,\n        isManual: -1\n      },\n      userRoles: [],\n      roleList: [],\n      errorPass: \"\",\n      userFormValidate: {\n        username: [{\n          required: true,\n          message: \"账号不能为空\",\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          required: true,\n          message: \"手机号不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\"\n        }]\n      },\n      submitLoading: false,\n      columns: [// {\n      //   type: \"selection\",\n      //   width: 60,\n      //   align: \"center\",\n      //   fixed: \"left\"\n      // },\n      {\n        type: \"expand\",\n        width: 50,\n        fixed: \"left\",\n        render: function render(h, params) {\n          return h(expandRow, {\n            props: {\n              row: params.row\n            }\n          });\n        }\n      }, {\n        type: \"index\",\n        width: 80,\n        align: \"center\",\n        fixed: \"left\",\n        title: \"序号\"\n      }, {\n        title: \"订单号\",\n        align: \"center\",\n        key: \"orderId\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\"\n      }, {\n        title: \"下单时间\",\n        align: \"center\",\n        key: \"createTime\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\"\n      }, {\n        title: \"订单类型\",\n        key: \"type\",\n        minWidth: 145,\n        sortable: true,\n        align: \"center\",\n        fixed: \"left\",\n        render: function render(h, params) {\n          var re = \"\";\n\n          if (params.row.type === 0) {\n            re = \"可再生回收\";\n          } else if (params.row.type === 1) {\n            re = \"付费回收\";\n          } else if (params.row.type === 2) {\n            re = \"运输服务\";\n          }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"人工派单\",\n        key: \"isManual\",\n        align: \"center\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\",\n        render: function render(h, params) {\n          var re = \"\";\n\n          if (params.row.isManual === 0) {\n            re = \"否\";\n          } else if (params.row.isManual === 1) {\n            re = \"是\";\n          }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"预约时间\",\n        key: \"appointmentTimeStr\",\n        align: \"center\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\"\n      }, {\n        title: \"支付方式\",\n        key: \"payType\",\n        align: \"center\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\",\n        render: function render(h, params) {\n          var re = \"\";\n\n          if (params.row.payType === 0) {\n            re = \"积分支付\";\n          } else if (params.row.payType === 1) {\n            re = \"现金支付\";\n          } else if (params.row.payType === 2) {\n            re = \"微信支付\";\n          } // else if (params.row.payType === 3) {\n          //   re = \"支付宝\";\n          // }\n          else if (params.row.payType === 9) {\n              re = \"其他\";\n            } else if (params.row.payType == null) {\n              re = \"暂无\";\n            }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"订单状态\",\n        align: \"center\",\n        key: \"status\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\",\n        render: function render(h, params) {\n          var re = \"\";\n          var color = \"\";\n\n          if (params.row.status === 0) {\n            re = \"待分配\";\n            color = \"#2575EC\";\n          } else if (params.row.status === 1) {\n            re = \"系统派单中\";\n            color = \"\t#DAA520\";\n          } else if (params.row.status === 2) {\n            re = \"已接单\";\n            color = \"#DAA520\";\n          } else if (params.row.status === 3) {\n            re = \"拒绝接单\";\n            color = \"#E52812\";\n          } else if (params.row.status === 4) {\n            re = \"待支付\";\n            color = \"#3CB371\";\n          } else if (params.row.status === 5) {\n            re = \"已取消\";\n            color = \"#D3D3D3\";\n          } else if (params.row.status === 6) {\n            re = \"已完成\";\n            color = \"#77C955\";\n          } else if (params.row.status === 7) {\n            re = \"已支付\";\n            color = \"#556B2F\";\n          }\n\n          return h(\"div\", {\n            style: {\n              color: color\n            }\n          }, re);\n        }\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        width: 200,\n        align: \"center\",\n        fixed: \"right\",\n        render: function render(h, params) {\n          var enableOrDisable = \"\"; // if (params.row.status == 0) {\n          //   enableOrDisable = h(\n          //     \"Button\",\n          //     {\n          //       props: {\n          //         size: \"small\"\n          //       },\n          //       style: {\n          //         marginRight: \"5px\"\n          //       },\n          //       on: {\n          //         click: () => {\n          //           this.disable(params.row);\n          //         }\n          //       }\n          //     },\n          //     \"禁用\"\n          //   );\n          // } else {\n          // enableOrDisable = h(\n          //   \"Button\",\n          //   {\n          //     props: {\n          //       type: \"success\",\n          //       size: \"small\"\n          //     },\n          //     style: {\n          //       marginRight: \"5px\"\n          //     },\n          //     on: {\n          //       click: () => {\n          //         this.enable(params.row);\n          //       }\n          //     }\n          //   },\n          //   \"启用\"\n          // );\n          // }\n\n          return h(\"div\", [h(\"Button\", {\n            props: {\n              type: \"primary\",\n              size: \"small\"\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.orderDetail(params.row);\n              }\n            }\n          }, \"订单详情\"), enableOrDisable, h(\"Button\", {\n            props: {\n              type: \"error\",\n              size: \"small\"\n            },\n            on: {\n              click: function click() {\n                if (params.row.status != 5 && params.row.status != 6) {\n                  _this.cancelOrder(params.row); //改成了取消订单的逻辑\n\n                } else if (params.row.status === 5) {\n                  _this.$Message.error(\"操作无效,该订单已经被取消!\");\n                } else {\n                  _this.$Message.error(\"操作无效,该订单已经完成!\");\n                }\n              }\n            }\n          }, \"取消订单\")]);\n        }\n      }],\n      exportColumns: [{\n        title: \"用户名\",\n        key: \"username\"\n      }, {\n        title: \"头像\",\n        key: \"avatar\"\n      }, {\n        title: \"所属部门ID\",\n        key: \"departmentId\"\n      }, {\n        title: \"所属部门\",\n        key: \"departmentTitle\"\n      }, {\n        title: \"手机\",\n        key: \"mobile\"\n      }, {\n        title: \"邮箱\",\n        key: \"email\"\n      }, {\n        title: \"性别\",\n        key: \"sex\"\n      }, {\n        title: \"用户类型\",\n        key: \"type\"\n      }, {\n        title: \"状态\",\n        key: \"status\"\n      }, {\n        title: \"删除标志\",\n        key: \"delFlag\"\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\"\n      }, {\n        title: \"更新时间\",\n        key: \"updateTime\"\n      }],\n      data: [],\n      exportData: [],\n      total: 0,\n      dictSex: []\n    };\n  },\n  methods: {\n    isAlarm: function isAlarm(data) {\n      for (var i = 0; i < data.length; i++) {\n        if (data[i].isManual == 1 && (data[i].status == 0 || data[i].status == 0)) {\n          this.count = 1;\n          break;\n        }\n      }\n    },\n    //获取待办事项\n    getAlarmMethod: function getAlarmMethod() {\n      var _this2 = this;\n\n      this.alarmModalVisible = true;\n      getAlarm().then(function (res) {\n        if (res.success === true) {\n          _this2.orderCount = res.result.orderCount;\n          _this2.allCount = res.result.allCount;\n          _this2.manualCount = res.result.manualCount;\n        }\n      });\n    },\n    init: function init() {\n      this.getUserList();\n      this.getDictSexData();\n    },\n    getDictSexData: function getDictSexData() {\n      var _this3 = this;\n\n      // 获取性别字典数据\n      getDictDataByType(\"sex\").then(function (res) {\n        if (res.success) {\n          _this3.dictSex = res.result;\n        }\n      });\n    },\n    handleSelectDepTree: function handleSelectDepTree(v) {\n      this.userForm.departmentId = v[0];\n    },\n    handleSelectDep: function handleSelectDep(v) {\n      this.searchForm.departmentId = v;\n    },\n    changePage: function changePage(v) {\n      this.searchForm.pageNumber = v;\n      this.getUserList();\n      this.clearSelectAll();\n    },\n    changePageSize: function changePageSize(v) {\n      this.searchForm.pageSize = v;\n      this.getUserList();\n    },\n    selectDateRange: function selectDateRange(v) {\n      if (v) {\n        this.searchForm.startDate = v[0];\n        this.searchForm.endDate = v[1];\n      }\n    },\n    getUserList: function getUserList() {\n      var _this4 = this;\n\n      // 多条件搜索用户列表\n      this.loading = true; // 避免后台默认值\n\n      if (!this.searchForm.type) {\n        this.searchForm.type = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\n      }\n\n      if (!this.searchForm.status) {\n        this.searchForm.status = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\n      }\n\n      if (!this.searchForm.payType) {\n        this.searchForm.payType = -1; //后台通过判断值是否小于0决定是否进行条件查询，小于0则查询所有type\n      }\n\n      getAllOrders(this.searchForm).then(function (res) {\n        _this4.loading = false;\n\n        if (res.success === true) {\n          _this4.data = res.result.records;\n\n          _this4.isAlarm(res.result.records);\n\n          _this4.total = res.result.total;\n        }\n      });\n    },\n    handleSearch: function handleSearch() {\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.getUserList();\n    },\n    handleReset: function handleReset() {\n      this.$refs.searchForm.resetFields();\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.selectDate = null;\n      this.searchForm.startDate = \"\";\n      this.searchForm.endDate = \"\";\n      this.selectDep = [];\n      this.searchForm.departmentId = \"\"; // 重新加载数据\n\n      this.getUserList();\n    },\n    changeSort: function changeSort(e) {\n      this.searchForm.sort = e.key;\n      this.searchForm.order = e.order;\n\n      if (e.order === \"normal\") {\n        this.searchForm.order = \"\";\n      }\n\n      this.getUserList();\n    },\n    getRoleList: function getRoleList() {\n      var _this5 = this;\n\n      getAllRoleList().then(function (res) {\n        if (res.success === true) {\n          _this5.roleList = res.result;\n        }\n      });\n    },\n    handleDropdown: function handleDropdown(name) {\n      var _this6 = this;\n\n      if (name === \"refresh\") {\n        this.getUserList();\n      } else if (name === \"exportData\") {\n        if (this.selectCount <= 0) {\n          this.$Message.warning(\"您还未选择要导出的数据\");\n          return;\n        }\n\n        this.$Modal.confirm({\n          title: \"确认导出\",\n          content: \"您确认要导出所选 \" + this.selectCount + \" 条数据?\",\n          onOk: function onOk() {\n            _this6.$refs.exportTable.exportCsv({\n              filename: \"用户数据\"\n            });\n          }\n        });\n      } else if (name === \"exportAll\") {\n        this.modalExportAll = true;\n      } else if (name === \"importData\") {\n        this.$Modal.info({\n          title: \"暂未开发\",\n          content: \"请期待\"\n        });\n      }\n    },\n    exportAll: function exportAll() {\n      var _this7 = this;\n\n      getAllOrders.then(function (res) {\n        _this7.modalExportAll = false;\n\n        if (res.success) {\n          _this7.exportData = res.result;\n          setTimeout(function () {\n            _this7.$refs.exportTable.exportCsv({\n              filename: \"用户全部数据\"\n            });\n          }, 1000);\n        }\n      });\n    },\n    cancelUser: function cancelUser() {\n      this.userModalVisible = false;\n    },\n    submitUser: function submitUser() {\n      var _this8 = this;\n\n      this.$refs.userForm.validate(function (valid) {\n        if (valid) {\n          if (_this8.modalType === 0) {\n            // 添加用户 避免编辑后传入id\n            delete _this8.userForm.id;\n            delete _this8.userForm.status;\n            _this8.submitLoading = true;\n            addOneOrder(_this8.userForm).then(function (res) {\n              _this8.submitLoading = false;\n\n              if (res.success === true) {\n                _this8.$Message.success(\"操作成功\");\n\n                _this8.getUserList();\n\n                _this8.userModalVisible = false;\n              }\n            });\n          } else {\n            // 编辑\n            _this8.submitLoading = true;\n            editUser(_this8.userForm).then(function (res) {\n              _this8.submitLoading = false;\n\n              if (res.success === true) {\n                _this8.$Message.success(\"操作成功\");\n\n                _this8.getUserList();\n\n                _this8.userModalVisible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    handleUpload: function handleUpload(v) {\n      this.userForm.avatar = v;\n    },\n    // add() {\n    //   this.modalType = 0;\n    //   this.modalTitle = \"添加订单\";\n    //   this.$refs.userForm.resetFields();\n    //   this.userModalVisible = true;\n    // },\n    //打开新的页面显示订单详情并可以人工派单\n    orderDetail: function orderDetail(v) {\n      // this.modalTitle = \"订单详情\";    别注释\n      // this.$router.push({path:'/order-detail',query:{orderData:v}});\n      this.$router.push({\n        name: \"order-detail-manage\",\n        query: {\n          orderData: v\n        }\n      });\n    },\n    cancelOrder: function cancelOrder(v) {\n      var _this9 = this;\n\n      this.$Modal.confirm({\n        title: \"确认取消\",\n        content: \"您确认要取消订单 \" + v.orderId + \" ?\",\n        onOk: function onOk() {\n          cancelOneOrder(v).then(function (res) {\n            _this9.operationLoading = true;\n\n            if (res.success === true) {\n              _this9.operationLoading = false;\n\n              _this9.$Message.success(res.message);\n\n              _this9.getUserList();\n            }\n          });\n        }\n      });\n    },\n    showSelect: function showSelect(e) {\n      this.exportData = e;\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    clearSelectAll: function clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    },\n    delAll: function delAll() {\n      var _this10 = this;\n\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未选择要删除的数据\");\n        return;\n      }\n\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        onOk: function onOk() {\n          var ids = \"\";\n\n          _this10.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n\n          ids = ids.substring(0, ids.length - 1);\n          _this10.operationLoading = true;\n          delOneOrder(ids).then(function (res) {\n            _this10.operationLoading = false;\n\n            if (res.success === true) {\n              _this10.$Message.success(\"删除成功\");\n\n              _this10.clearSelectAll();\n\n              _this10.getUserList();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n    this.getRoleList();\n  }\n};",null]}