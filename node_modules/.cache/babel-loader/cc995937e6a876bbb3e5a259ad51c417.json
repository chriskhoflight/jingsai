{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\sys\\menu-manage\\menuManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\sys\\menu-manage\\menuManage.vue","mtime":1564969187236},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAllPermissionList, addPermission, editPermission, deletePermission, searchPermission, getDictDataByType } from \"@/api/index\";\nimport IconChoose from \"@/views/components/custom/icon-choose\";\nimport util from \"@/libs/util.js\";\nexport default {\n  name: \"menu-manage\",\n  components: {\n    IconChoose: IconChoose\n  },\n  data: function data() {\n    return {\n      loading: true,\n      strict: true,\n      maxHeight: \"500px\",\n      expandLevel: 1,\n      menuModalVisible: false,\n      iconModalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      searchKey: \"\",\n      parentTitle: \"\",\n      // isMenu: false,\n      // isButton: false,\n      editTitle: \"\",\n      modalTitle: \"\",\n      menuForm: {\n        id: \"\",\n        title: \"\",\n        name: \"\",\n        icon: \"\",\n        path: \"\",\n        component: \"\",\n        parentId: \"\",\n        buttonType: \"\",\n        type: 0,\n        sortOrder: 0,\n        level: null,\n        status: 0,\n        url: \"\"\n      },\n      menuFormAdd: {\n        buttonType: \"\"\n      },\n      menuFormValidate: {\n        title: [{\n          required: true,\n          message: \"名称不能为空\",\n          trigger: \"blur\"\n        }],\n        name: [{\n          required: true,\n          message: \"路由英文名不能为空\",\n          trigger: \"blur\"\n        }],\n        icon: [{\n          required: true,\n          message: \"图标不能为空\",\n          trigger: \"click\"\n        }],\n        path: [{\n          required: true,\n          message: \"路径不能为空\",\n          trigger: \"blur\"\n        }],\n        component: [{\n          required: true,\n          message: \"前端组件不能为空\",\n          trigger: \"blur\"\n        }]\n      },\n      submitLoading: false,\n      data: [],\n      dictPermissions: [],\n      iconType: 0,\n      dictComponent: []\n    };\n  },\n  methods: {\n    init: function init() {\n      this.getAllList();\n      this.getDictPermissions();\n      this.getDictComponent();\n    },\n    getDictPermissions: function getDictPermissions() {\n      var _this = this;\n\n      getDictDataByType(\"permission_type\").then(function (res) {\n        if (res.success) {\n          _this.dictPermissions = res.result;\n        }\n      });\n    },\n    //加载组件类型\n    getDictComponent: function getDictComponent() {\n      var _this2 = this;\n\n      getDictDataByType(\"component\").then(function (res) {\n        if (res.success) {\n          _this2.dictComponent = res.result;\n        }\n      });\n    },\n    showEditIcon: function showEditIcon(v) {\n      this.iconType = v;\n      this.iconModalVisible = true;\n    },\n    handleSelectIcon: function handleSelectIcon(v) {\n      if (this.iconType == 0) {\n        this.menuForm.icon = v;\n      } else {\n        this.menuFormAdd.icon = v;\n      }\n\n      this.iconModalVisible = false;\n    },\n    handleDropdown: function handleDropdown(name) {\n      if (name === \"expandOne\") {\n        this.expandLevel = 1;\n        this.getAllList();\n      } else if (name === \"expandTwo\") {\n        this.expandLevel = 2;\n        this.getAllList();\n      } else if (name === \"expandAll\") {\n        this.expandLevel = 3;\n        this.getAllList();\n      } else if (name === \"refresh\") {\n        this.getAllList();\n      }\n    },\n    getAllList: function getAllList() {\n      var _this3 = this;\n\n      this.loading = true;\n      this.getRequest(\"/permission/getAllList\").then(function (res) {\n        _this3.loading = false;\n\n        if (res.success === true) {\n          // 仅展开指定级数 默认一级\n          var expandLevel = _this3.expandLevel;\n          res.result.forEach(function (e) {\n            if (expandLevel === 1) {\n              if (e.level === 1) {\n                e.expand = false;\n              }\n\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function (c) {\n                  if (c.level === 2) {\n                    c.expand = false;\n                  }\n                });\n              }\n            } else {\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function (c) {\n                  if (expandLevel === 2) {\n                    if (c.level === 2) {\n                      c.expand = false;\n                    }\n                  }\n                });\n              }\n            }\n          });\n          _this3.data = res.result;\n        }\n      });\n    },\n    search: function search() {\n      var _this4 = this;\n\n      if (this.searchKey) {\n        this.loading = true;\n        searchPermission({\n          title: this.searchKey\n        }).then(function (res) {\n          _this4.loading = false;\n\n          if (res.success) {\n            _this4.data = res.result;\n          }\n        });\n      } else {\n        this.getAllList();\n      }\n    },\n    selectTree: function selectTree(v) {\n      if (v.length > 0) {\n        // if (Number(v[0].level) === 1 || Number(v[0].level) === 2) {\n        //   this.isButton = false;\n        //   this.isMenu = true;\n        // } else {\n        //   this.isButton = true;\n        //   this.isMenu = false;\n        // }\n        if (Number(v[0].status) === 0) {\n          this.editStatus = true;\n        } else {\n          this.editStatus = false;\n        } // 转换null为\"\"\n\n\n        for (var attr in v[0]) {\n          if (v[0][attr] === null) {\n            v[0][attr] = \"\";\n          }\n        }\n\n        var str = JSON.stringify(v[0]);\n        var menu = JSON.parse(str);\n        this.menuForm = menu;\n        this.editTitle = menu.title;\n      } else {\n        this.cancelEdit();\n      }\n    },\n    cancelEdit: function cancelEdit() {\n      var data = this.$refs.tree.getSelectedNodes()[0];\n\n      if (data) {\n        data.selected = false;\n      } // this.isMenu = false;\n      // this.isButton = false;\n\n\n      this.$refs.menuForm.resetFields();\n      delete this.menuForm.id;\n      this.editTitle = \"\";\n    },\n    cancelAdd: function cancelAdd() {\n      this.menuModalVisible = false;\n    },\n    handleReset: function handleReset() {\n      var type = this.menuForm.type;\n      this.$refs.menuForm.resetFields();\n      this.editStatus = true;\n      this.menuForm.type = type;\n    },\n    submitEdit: function submitEdit() {\n      var _this5 = this;\n\n      this.$refs.menuForm.validate(function (valid) {\n        if (valid) {\n          if (!_this5.menuForm.id) {\n            _this5.$Message.warning(\"请先点击选择要修改的菜单节点\");\n\n            return;\n          }\n\n          _this5.submitLoading = true;\n\n          if (_this5.menuForm.sortOrder === null) {\n            _this5.menuForm.sortOrder = \"\";\n          }\n\n          if (_this5.menuForm.buttonType === null) {\n            _this5.menuForm.buttonType = \"\";\n          }\n\n          if (_this5.menuForm.type == 2) {\n            _this5.menuForm.name = \"\";\n            _this5.menuForm.icon = \"\";\n            _this5.menuForm.component = \"\";\n          }\n\n          editPermission(_this5.menuForm).then(function (res) {\n            _this5.submitLoading = false;\n\n            if (res.success === true) {\n              _this5.$Message.success(\"编辑成功\");\n\n              util.initRouter(_this5);\n\n              _this5.init();\n\n              _this5.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    submitAdd: function submitAdd() {\n      var _this6 = this;\n\n      this.$refs.menuFormAdd.validate(function (valid) {\n        if (valid) {\n          _this6.submitLoading = true;\n\n          if (_this6.menuFormAdd.type == 2) {\n            _this6.menuFormAdd.name = \"\";\n            _this6.menuFormAdd.icon = \"\";\n            _this6.menuFormAdd.component = \"\";\n          }\n\n          addPermission(_this6.menuFormAdd).then(function (res) {\n            _this6.submitLoading = false;\n\n            if (res.success === true) {\n              _this6.$Message.success(\"添加成功\");\n\n              util.initRouter(_this6);\n\n              _this6.init();\n\n              _this6.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    //添加菜单\n    addMenu: function addMenu() {\n      if (this.menuForm.id == \"\" || this.menuForm.id == null) {\n        this.$Message.warning(\"请先点击选择一个菜单权限节点\");\n        return;\n      }\n\n      if (!(this.menuForm.type === 0 || this.menuForm.component == 'ParentView')) {\n        this.$Message.warning(\"请选择导航节点或父菜单节点\");\n        return;\n      }\n\n      this.parentTitle = this.menuForm.title;\n      this.modalTitle = \"添加菜单权限(可拖动)\";\n      this.showParent = true;\n      var type = 1;\n      this.menuFormAdd = {\n        icon: \"\",\n        type: type,\n        parentId: this.menuForm.id,\n        level: Number(this.menuForm.level) + 1,\n        sortOrder: 0,\n        buttonType: \"\",\n        status: 0\n      };\n      this.menuModalVisible = true;\n    },\n    addRootMenu: function addRootMenu() {\n      this.modalTitle = \"添加导航栏(可拖动)\";\n      this.showParent = false;\n      this.menuFormAdd = {\n        component: \"Main\",\n        type: 0,\n        //0-导航  1-菜单页面 2-按钮 \n        level: 1,\n        //\n        sortOrder: 0,\n        status: 0\n      };\n      this.menuModalVisible = true;\n    },\n    addButton: function addButton() {\n      if (this.menuForm.id == \"\" || this.menuForm.id == null || this.menuForm.type != 1 || this.menuForm.component === 'ParentView') {\n        this.$Message.warning(\"请先点击选择一个菜单页面节点\");\n        return;\n      }\n\n      this.parentTitle = this.menuForm.title;\n      this.modalTitle = \"添加按钮(可拖动)\";\n      this.showParent = true;\n      var type = 2;\n      this.menuFormAdd = {\n        icon: \"\",\n        type: type,\n        parentId: this.menuForm.id,\n        level: Number(this.menuForm.level) + 1,\n        sortOrder: 0,\n        buttonType: \"\",\n        status: 0\n      };\n      this.menuModalVisible = true;\n    },\n    changeSelect: function changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    delAll: function delAll() {\n      var _this7 = this;\n\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未勾选要删除的数据\");\n        return;\n      }\n\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        onOk: function onOk() {\n          var ids = \"\";\n\n          _this7.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n\n          ids = ids.substring(0, ids.length - 1);\n          deletePermission(ids).then(function (res) {\n            if (res.success === true) {\n              _this7.$Message.success(\"删除成功\");\n\n              util.initRouter(_this7);\n              _this7.selectList = [];\n              _this7.selectCount = 0;\n\n              _this7.cancelEdit();\n\n              _this7.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    // 计算高度\n    var height = document.documentElement.clientHeight;\n    this.maxHeight = Number(height - 287) + \"px\";\n    this.init();\n  }\n};",null]}