{"remainingRequest":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\order-detail-manage\\orderDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\src\\views\\orders\\order-detail-manage\\orderDetail.vue","mtime":1568024242635},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jingsai\\rcms_src\\rcms-pc-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getOrderDetail, getOnlineRp, dispatchOrder, manualFinishOrder } from \"@/api/orders\";\nimport { truncate } from \"fs\";\nexport default {\n  data: function data() {\n    var _orderDetail;\n\n    return {\n      //图片url list\n      // urlsList: [],\n      imgModal: false,\n      //查看大图\n      bigImgUrl: null,\n      //大图链接\n      isBigImg: false,\n      isRefuse: null,\n      isCancel: null,\n      isFinish: null,\n      isPay: null,\n      isPayed: null,\n      //在线回收人员\n      RecyclingPersonnel: [],\n      color: \"color\",\n      dispatchForm: {\n        RecyclingPersonnelId: \"\",\n        orderId: \"\",\n        RecyclingPersonnelName: \"\"\n      },\n      // confirmDialog: false, //人工派单确定对话框\n      dispatchModalVisible: false,\n      //人工派单对话框是否显示\n      orderDetailForm: {\n        id: \"\",\n        //主键\n        orderId: \"\" //订单号-\n\n      },\n      //前一个页面传来的数据\n      orderDetail: (_orderDetail = {\n        userRemark: \"\",\n        recyclinRemark: \"\",\n        score: null,\n        //用户评分\n        recScore: null,\n        //回收人员评分\n        comment: \"\",\n        //用户评价\n        recComment: \"\",\n        //回收人员评分\n        estimatedPrice: 0.00,\n        paidPrice: 0.00,\n        additionalCosts: 0.00,\n        destContactsAdderss: \"\",\n        destContactsName: \"\",\n        destContactsPhone: \"\"\n      }, _defineProperty(_orderDetail, \"additionalCosts\", 0), _defineProperty(_orderDetail, \"id\", \"\"), _defineProperty(_orderDetail, \"imgUrls\", \"\"), _defineProperty(_orderDetail, \"appointmentDay\", \"\"), _defineProperty(_orderDetail, \"appointmentStartTime\", \"\"), _defineProperty(_orderDetail, \"appointmentEndTime\", \"\"), _defineProperty(_orderDetail, \"phone\", \"\"), _defineProperty(_orderDetail, \"orderId\", \"\"), _defineProperty(_orderDetail, \"type\", -1), _defineProperty(_orderDetail, \"contactsPhone\", \"\"), _defineProperty(_orderDetail, \"contactsName\", \"\"), _defineProperty(_orderDetail, \"isElevatorRoom\", -1), _defineProperty(_orderDetail, \"contactsFloor\", -1), _defineProperty(_orderDetail, \"contactsAdderss\", \"\"), _defineProperty(_orderDetail, \"name\", \"\"), _defineProperty(_orderDetail, \"status\", -1), _orderDetail),\n      //商品的表格\n      columns: [{\n        title: \"商品名称\",\n        key: \"name\"\n      }, {\n        title: \"商品数量\",\n        key: \"goodsNum\"\n      }, {\n        title: \"预估最小价格(单价)\",\n        key: \"minPrice\"\n      }, {\n        title: \"预估最大价格(单价)\",\n        key: \"maxPrice\"\n      }, {\n        title: \"该类商品预估最小价格\",\n        key: \"goodMinTotalPrice\"\n      }, {\n        title: \"该类商品预估最大价格\",\n        key: \"goodMaxTotalPrice\"\n      }],\n      //在线回收人员的表格\n      RecyclingPersonnelColumns: [{\n        title: \"姓名\",\n        key: \"name\"\n      }, {\n        title: \"手机号码\",\n        key: \"phone\"\n      }, {\n        title: \"地址\",\n        key: \"address\"\n      }],\n      //订单商品的明细\n      OrderGoodsList: []\n    };\n  },\n  computed: {\n    //展示评价\n    isRemark: function isRemark() {\n      if ((this.orderDetail.recyclinRemark = null && this.orderDetail.recyclinRemark != \"\") || this.orderDetail.userRemark != null && this.orderDetail.userRemark != \"\") {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    //type=2  ---> 运输服务\n    isTrac: function isTrac() {\n      if (this.orderDetail.type == 2) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    urlsList: function urlsList() {\n      return this.orderDetail.imgUrls.split(\";\");\n    },\n    isManualFinish: function isManualFinish() {\n      if (this.orderDetail.status != 5 && this.orderDetail.status != 6) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    CpType: function CpType() {\n      if (this.orderDetail.type === 0) {\n        return \"可再生回收\";\n      } else if (this.orderDetail.type === 1) {\n        return \"付费回收\";\n      } else if (this.orderDetail.type === 2) {\n        return \"运输服务\";\n      }\n    },\n    // isPay: function() {\n    //   if (this.orderDetail.type === 0) {\n    //     //可再生垃圾回收是回收人员支付钱给用户\n    //     return false;\n    //   } else {\n    //     return true;\n    //   }\n    // },\n    isDispactched: function isDispactched() {\n      if (this.orderDetail.status === 0 || this.orderDetail.status === 1 || this.orderDetail.status === 3) {\n        return true;\n      } else return false;\n    },\n    isElevatorRoom: function isElevatorRoom() {\n      if (this.orderDetail.isElevatorRoom == 0) {\n        return \"是\";\n      } else if (this.orderDetail.isElevatorRoom == 1) {\n        return \"否\";\n      }\n    },\n    status: function status() {\n      if (this.orderDetail.status == 0) {\n        return \"待分配\";\n      } else if (this.orderDetail.status == 1) {\n        return \"系统派单中\";\n      } else if (this.orderDetail.status == 2) {\n        return \"已接单\";\n      } else if (this.orderDetail.status == 3) {\n        return \"拒绝接单\";\n      } else if (this.orderDetail.status == 4) {\n        return \"待支付\";\n      } else if (this.orderDetail.status == 5) {\n        return \"已取消\";\n      } else if (this.orderDetail.status == 6) {\n        return \"已完成\";\n      }\n    },\n    type: function type() {\n      if (this.orderDetail.type == 0) {\n        return \"可再生回收\";\n      } else if (this.orderDetail.type == 1) {\n        return \"付费回收\";\n      } else if (this.orderDetail.type == 2) {\n        return \"运输服务\";\n      }\n    },\n    //订单状态\n    //type=0的话用户是不需要支付的，是回收人员支付钱，故待支付为false\n    //状态：0待分配 1系统已派单,待接单 2已接单 3拒绝接单 4等待用户支付（付费回收才有） 5已取消 6已完成'  7已支付\n    whichSatatus: function whichSatatus() {\n      if (this.orderDetail.status == 0 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isFinish = true;\n        return 0;\n      } else if (this.orderDetail.status == 0 && !this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPayed = true;\n        this.isPay = true;\n        this.isFinish = true;\n        return 0;\n      } else if (this.orderDetail.status == 1 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPay = false;\n        this.isPayed = true;\n        this.isFinish = true;\n        return 1;\n      } else if (this.orderDetail.status == 1 && !this.orderDetail.type == 0) {\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isFinish = true;\n        return 1;\n      } else if (this.orderDetail.status == 2 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isFinish = true;\n        return 2;\n      } else if (this.orderDetail.status == 2 && !this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isCancel = false;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isFinish = true;\n        return 2;\n      } else if (this.orderDetail.status == 3 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isCancel = false;\n        this.isFinish = true;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isRefuse = true;\n        return 3;\n      } else if (this.orderDetail.status == 3 && !this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isCancel = false;\n        this.isFinish = true;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isRefuse = true;\n        return 3;\n      } else if (this.orderDetail.status == 4 && this.orderDetail.type == 0) {\n        //本身就是待支付状态\n        // console.log(this.orderDetail.status);\n        this.isCancel = false;\n        this.isFinish = true;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isRefuse = false;\n        return 3; //因为拒绝接单被隐藏了  所以要显示待支付下标要-1\n      } else if (this.orderDetail.status == 4 && !this.orderDetail.type == 0) {\n        //本身就是待支付状态\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isCancel = false;\n        this.isFinish = true;\n        return 3; //因为拒绝接单被隐藏了  所以要显示待支付下标要-1\n      } else if (this.orderDetail.status == 5 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isCancel = true;\n        this.isFinish = false;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isRefuse = false;\n        return 3;\n      } else if (this.orderDetail.status == 5 && !this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isCancel = true;\n        this.isFinish = false;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isRefuse = false;\n        return 5;\n      } else if (this.orderDetail.status == 6 && this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isCancel = false;\n        this.isFinish = true;\n        this.isPay = false;\n        this.isPayed = false;\n        this.isRefuse = false;\n        return 3;\n      } else if (this.orderDetail.status == 6 && !this.orderDetail.type == 0) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isPay = true;\n        this.isPayed = false;\n        this.isCancel = false;\n        this.isFinish = true;\n        return 5; //已支付\n      } else if (this.orderDetail.status == 7) {\n        // console.log(this.orderDetail.status);\n        this.isRefuse = false;\n        this.isPay = true;\n        this.isPayed = true;\n        this.isCancel = false;\n        this.isFinish = true;\n        return 4;\n      }\n    }\n  },\n  methods: {\n    back: function back() {\n      this.$router.go(-1);\n    },\n    watchBigImg: function watchBigImg(v) {\n      this.imgModal = !this.imgModal;\n      this.bigImgUrl = v;\n    },\n    cancelDispactch: function cancelDispactch() {\n      this.dispatchModalVisible = false;\n    },\n    manualFinish: function manualFinish() {\n      var _this = this;\n\n      this.$Modal.confirm({\n        title: \"确认完成\",\n        content: \"确认人工完成订单\" + this.orderDetail.orderId + \"吗？\",\n        onOk: function onOk() {\n          manualFinishOrder(_this.orderDetail).then(function (res) {\n            if (res.success === true) {\n              _this.$Message.success(\"订单已完成!\");\n\n              location.reload();\n            } else if (res.success === false) {\n              _this.$Message.error(res.message + \"错误代码:\" + res.code);\n            }\n          });\n        }\n      });\n    },\n    //选择了一个回收人员  赋值给请求参数\n    selectRc: function selectRc(currentRow, oldCurrentRow) {\n      this.dispatchForm.orderId = this.orderDetail.orderId;\n      this.dispatchForm.RecyclingPersonnelId = currentRow.id;\n      this.dispatchForm.RecyclingPersonnelName = currentRow.name;\n    },\n    comfirmDispactch: function comfirmDispactch() {\n      var _this2 = this;\n\n      if (this.dispatchForm.RecyclingPersonnelName != \"\" && this.dispatchForm.RecyclingPersonnelName != null) {\n        this.$Modal.confirm({\n          title: \"确认分配\",\n          content: \"您确认要分配订单给\" + this.dispatchForm.RecyclingPersonnelName + \"?\",\n          onOk: function onOk() {\n            dispatchOrder(_this2.dispatchForm).then(function (res) {\n              if (res.success === true) {\n                _this2.dispatchModalVisible = false;\n                location.reload();\n              }\n            });\n            _this2.confirmDialog = true;\n          }\n        });\n      } else {\n        this.$Message.error(\"请选择人员\");\n      }\n    },\n    //发起请求通过订单号获取订单商品明细\n    getOrderDetailMethod: function getOrderDetailMethod() {\n      var _this3 = this;\n\n      this.orderDetailForm.id = this.orderDetail.id;\n      this.orderDetailForm.orderId = this.orderDetail.orderId;\n      getOrderDetail(this.orderDetailForm).then(function (res) {\n        if (res.success === true) {\n          if (res.result.orderGoodsList != null) {\n            _this3.OrderGoodsList = res.result.orderGoodsList;\n          }\n\n          _this3.orderDetail = res.result; //传数据渲染\n        }\n      });\n    },\n    // 人工派单的逻辑方法\n    dispatchOrderDialog: function dispatchOrderDialog() {\n      var _this4 = this;\n\n      this.dispatchModalVisible = true; //弹出对话框\n      //发送请求获取所有在线的回收人员\n\n      getOnlineRp().then(function (res) {\n        if (res.success === true) {\n          _this4.RecyclingPersonnel = res.result;\n        }\n      });\n    }\n  },\n  //渲染完毕\n  mounted: function mounted() {\n    this.getOrderDetailMethod(); //获取订单详情\n  },\n  //组件加载完毕\n  created: function created() {\n    var data = this.$route.query.orderData; // if (data != null && data != undefined && data.orderId != undefined) {\n    //   this.orderDetail = data;\n    //   this.setStore(\"orderDetail\", JSON.stringify(data));\n    // } else {\n    //   this.orderDetail = JSON.parse(this.getStore(\"orderDetail\") || \"{}\");\n    //   console.log(\"缓存取出orderDetail\");\n    // console.log(this.orderDetail);\n    // }\n\n    if (data != null && data != undefined && data.orderId != undefined) {\n      this.orderDetail = data;\n      this.setStore(\"orderId\", data.orderId);\n      this.setStore(\"id\", data.id);\n    } else {\n      this.orderDetail.id = this.getStore(\"id\");\n      this.orderDetail.orderId = this.getStore(\"orderId\");\n    }\n  }\n};",null]}